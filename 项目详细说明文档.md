# æ¡Œé¢å® ç‰©åº”ç”¨ - é¡¹ç›®è¯¦ç»†è¯´æ˜æ–‡æ¡£

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [ç•Œé¢è®¾è®¡ç³»ç»Ÿ](#ç•Œé¢è®¾è®¡ç³»ç»Ÿ)
5. [æ•°æ®æµä¸çŠ¶æ€ç®¡ç†](#æ•°æ®æµä¸çŠ¶æ€ç®¡ç†)
6. [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)

---

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº SwiftUI å¼€å‘çš„ macOS æ¡Œé¢å® ç‰©åº”ç”¨ï¼Œæä¾›äº†ä¸€ä¸ªå¯çˆ±çš„ AI ä¼´ä¾£ï¼Œèƒ½å¤Ÿï¼š
- åœ¨æ¡Œé¢ä¸Šæ˜¾ç¤ºåŠ¨æ€ GIF è§’è‰²
- ä¸ç”¨æˆ·è¿›è¡Œ AI å¯¹è¯äº¤äº’
- å®šæœŸè‡ªåŠ¨æ˜¾ç¤ºæ¶ˆæ¯
- æ”¯æŒå¤šè§’è‰²åˆ‡æ¢
- æ”¯æŒè‡ªå®šä¹‰è§’è‰²å¯¼å…¥
- é›†æˆ Apple Music éŸ³ä¹æ’­æ”¾åŠŸèƒ½

**æŠ€æœ¯æ ˆï¼š**
- SwiftUI (ç•Œé¢æ¡†æ¶)
- Combine (å“åº”å¼ç¼–ç¨‹)
- URLSession (ç½‘ç»œè¯·æ±‚)
- UserDefaults (æ•°æ®æŒä¹…åŒ–)
- AppKit (çª—å£ç®¡ç†)

---

## é¡¹ç›®ç»“æ„

```
æ¡Œé¢å® ç‰©åº”ç”¨/
â”œâ”€â”€ Sources/
â”‚   â”œâ”€â”€ App/                    # åº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ PetApp.swift       # ä¸»åº”ç”¨å’Œçª—å£é…ç½®
â”‚   â”œâ”€â”€ Models/                 # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ PreferencesModels.swift  # åå¥½è®¾ç½®ç›¸å…³æ¨¡å‹
â”‚   â”œâ”€â”€ Views/                  # è§†å›¾å±‚
â”‚   â”‚   â”œâ”€â”€ PetView.swift      # ä¸»å® ç‰©è§†å›¾
â”‚   â”‚   â””â”€â”€ PreferencesView.swift    # åå¥½è®¾ç½®è§†å›¾
â”‚   â”œâ”€â”€ ViewModels/             # è§†å›¾æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ PetViewBackend.swift     # å® ç‰©è§†å›¾ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ PreferencesViewBackend.swift  # åå¥½è®¾ç½®ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ Services/               # æœåŠ¡å±‚
â”‚   â”‚   â””â”€â”€ APIManager.swift   # API é€šä¿¡ç®¡ç†
â”‚   â”œâ”€â”€ UI/                     # UI ç»„ä»¶å’Œæ ·å¼
â”‚   â”‚   â”œâ”€â”€ DesignSystem.swift # è®¾è®¡ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ViewModifiers.swift # è§†å›¾ä¿®é¥°å™¨
â”‚   â””â”€â”€ Utils/                  # å·¥å…·ç±»
â”‚       â””â”€â”€ gif_library.swift  # è§’è‰²æ•°æ®ç®¡ç†
â”œâ”€â”€ Resources/                  # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ Animations/            # GIF åŠ¨ç”»æ–‡ä»¶
â”‚   â””â”€â”€ Assets.xcassets/       # å›¾æ ‡èµ„æº
â””â”€â”€ Preview Content/            # é¢„è§ˆèµ„æº
```

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. App æ¨¡å— - åº”ç”¨å…¥å£

#### PetApp.swift

**ä½œç”¨ï¼š** åº”ç”¨ç¨‹åºçš„ä¸»å…¥å£ç‚¹ï¼Œè´Ÿè´£åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œçª—å£é…ç½®ã€‚

**æ ¸å¿ƒç»„ä»¶ï¼š**

##### PetApp (ä¸»ç»“æ„ä½“)
```swift
@main
struct PetApp: App
```

**åŠŸèƒ½ï¼š**
- ä½¿ç”¨ `@main` æ ‡è®°ä¸ºåº”ç”¨å…¥å£
- åˆ›å»ºå¹¶ç®¡ç† `PetViewBackend` å®ä¾‹ï¼ˆå…¨å±€å…±äº«ï¼‰
- é…ç½®ä¸»çª—å£å’Œèœå•å‘½ä»¤

**çª—å£é…ç½®ï¼š**
- çª—å£ ID: `"main-pet-window"`
- çª—å£æ ‡é¢˜: `"Pet"`
- æœ€å°å°ºå¯¸: 200x200
- çª—å£æ ·å¼: éšè—æ ‡é¢˜æ  (`.hiddenTitleBar`)
- é»˜è®¤ä½ç½®: å±å¹•ä¸­å¿ƒ

**èœå•å‘½ä»¤ï¼š**
- æ›¿æ¢é»˜è®¤çš„"åå¥½è®¾ç½®"èœå•é¡¹
- å¿«æ·é”®: `Cmd + ,`
- ç‚¹å‡»åæ‰“å¼€åå¥½è®¾ç½®çª—å£

**åå¥½è®¾ç½®çª—å£æ–¹æ³•ï¼š**
```swift
private func showPreferencesWindow()
```
- åˆ›å»ºç‹¬ç«‹çš„åå¥½è®¾ç½®çª—å£
- å°ºå¯¸: 500x400
- æ ·å¼: æ ‡å‡†çª—å£ï¼ˆå¯å…³é—­ã€æœ€å°åŒ–ã€è°ƒæ•´å¤§å°ï¼‰
- å…±äº«åŒä¸€ä¸ª `backend` å®ä¾‹ï¼Œç¡®ä¿æ•°æ®åŒæ­¥

---

##### AppDelegate (åº”ç”¨å§”æ‰˜)

**ä½œç”¨ï¼š** å¤„ç†åº”ç”¨çº§åˆ«çš„äº‹ä»¶å’Œçª—å£é…ç½®ã€‚

**æ ¸å¿ƒæ–¹æ³•ï¼š**

1. **applicationDidFinishLaunching**
   - åº”ç”¨å¯åŠ¨å®Œæˆæ—¶è°ƒç”¨
   - é…ç½®ä¸»çª—å£çš„é€æ˜æ‚¬æµ®æ•ˆæœ

2. **applicationDidBecomeActive**
   - åº”ç”¨æ¿€æ´»æ—¶è°ƒç”¨
   - é‡æ–°åº”ç”¨çª—å£é…ç½®

3. **configureMainWindow**
   - æŸ¥æ‰¾ä¸»çª—å£
   - åº”ç”¨é€æ˜æ ·å¼

4. **applyTransparentStyle**
   - éšè—æ ‡é¢˜æ 
   - è®¾ç½®çª—å£é€æ˜
   - ç§»é™¤é˜´å½±
   - è®¾ç½®ä¸ºæ‚¬æµ®çª—å£ï¼ˆå§‹ç»ˆåœ¨æœ€å‰ï¼‰
   - å…è®¸åœ¨æ‰€æœ‰ç©ºé—´æ˜¾ç¤º
   - å…è®¸é€šè¿‡èƒŒæ™¯æ‹–åŠ¨çª—å£

**çª—å£ç‰¹æ€§ï¼š**
- `titleVisibility = .hidden` - éšè—æ ‡é¢˜
- `titlebarAppearsTransparent = true` - é€æ˜æ ‡é¢˜æ 
- `isOpaque = false` - çª—å£ä¸é€æ˜åº¦
- `backgroundColor = .clear` - é€æ˜èƒŒæ™¯
- `hasShadow = false` - æ— é˜´å½±
- `level = .floating` - æ‚¬æµ®çº§åˆ«
- `collectionBehavior = [.canJoinAllSpaces, .fullScreenAuxiliary]` - å¤šç©ºé—´æ”¯æŒ
- `isMovableByWindowBackground = true` - å¯æ‹–åŠ¨

---

### 2. Views æ¨¡å— - è§†å›¾å±‚

#### PetView.swift

**ä½œç”¨ï¼š** ä¸»å® ç‰©è§†å›¾ï¼Œæ˜¾ç¤º GIF åŠ¨ç”»å’Œå¯¹è¯ç•Œé¢ã€‚

**æ ¸å¿ƒç»„ä»¶ï¼š**

##### PetView (ä¸»è§†å›¾ç»“æ„ä½“)

**çŠ¶æ€å±æ€§ï¼š**
- `@ObservedObject var petViewBackend` - è§‚å¯Ÿåç«¯çŠ¶æ€å˜åŒ–
- `@AppStorage("overlapRatio")` - ç•Œé¢é‡å æ¯”ä¾‹ï¼ˆ0.0-1.0ï¼‰
- `@State private var isDragging` - æ˜¯å¦æ­£åœ¨æ‹–åŠ¨
- `@FocusState private var isInputFocused` - è¾“å…¥æ¡†ç„¦ç‚¹çŠ¶æ€

**ç•Œé¢å¸ƒå±€ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     è¾“å…¥æ¡† (inputField)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚   å¯¹è¯è¾“å‡ºåŒº (chatOutput)    â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚   å® ç‰©å›¾åƒ (petImage)        â”‚
â”‚   (GIF åŠ¨ç”»)                â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**1. è¾“å…¥æ¡†åŒºåŸŸ (inputField)**
- ä½ç½®: é¡¶éƒ¨
- ç»„ä»¶: `TextField` + å‘é€æŒ‰é’®
- åŠŸèƒ½:
  - ç”¨æˆ·è¾“å…¥æ–‡æœ¬
  - å›è½¦é”®æäº¤
  - å‘é€æŒ‰é’®æäº¤
  - æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ
  - åœ†è§’è¾¹æ¡†
- æ ·å¼:
  - é«˜åº¦: 24pt
  - å†…è¾¹è·: 8pt
  - èƒŒæ™¯: ç™½è‰²åŠé€æ˜ (opacity 0.3)
  - åœ†è§’: 12pt

**2. å¯¹è¯è¾“å‡ºåŒº (chatOutput)**
- ä½ç½®: ä¸­é—´
- ç»„ä»¶: `ScrollView` + `Text`
- åŠŸèƒ½:
  - æ˜¾ç¤º AI å›å¤
  - æ˜¾ç¤ºè‡ªåŠ¨æ¶ˆæ¯
  - æ˜¾ç¤ºæ€è€ƒçŠ¶æ€
  - è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- å†…å®¹:
  - æ€è€ƒä¸­: "æ€è€ƒä¸­..."
  - æ­£å¸¸: æ˜¾ç¤º `streamedResponse`
  - ç©ºç™½: æ˜¾ç¤ºæç¤ºæ–‡æœ¬
- æ ·å¼:
  - èƒŒæ™¯: ç™½è‰²åŠé€æ˜ (opacity 0.2)
  - åœ†è§’: 12pt
  - å†…è¾¹è·: 12pt
  - å­—ä½“: 14pt ç³»ç»Ÿå­—ä½“

**3. å® ç‰©å›¾åƒåŒº (petImage)**
- ä½ç½®: åº•éƒ¨ï¼ˆä¸å¯¹è¯åŒºé‡å ï¼‰
- ç»„ä»¶: `GIFImageView`
- åŠŸèƒ½:
  - æ˜¾ç¤º GIF åŠ¨ç”»
  - ç‚¹å‡»è§¦å‘åŠ¨ä½œ
  - æ‹–åŠ¨ç§»åŠ¨çª—å£
- äº¤äº’:
  - å•å‡»: æ’­æ”¾ç‚¹å‡»åŠ¨ç”»
  - æ‹–åŠ¨: ç§»åŠ¨æ•´ä¸ªçª—å£
- æ ·å¼:
  - å°ºå¯¸: 150x150
  - å¯è°ƒæ•´å¤§å°

**é‡å è®¡ç®—é€»è¾‘ï¼š**
```swift
let overlapAmount = 150 * overlapRatio
```
- `overlapRatio = 0.0`: ä¸é‡å ï¼ˆé—´è· 30pxï¼‰
- `overlapRatio = 0.5`: éƒ¨åˆ†é‡å 
- `overlapRatio = 1.0`: å®Œå…¨é‡å 

**æ‹–åŠ¨åŠŸèƒ½ï¼š**
- ä½¿ç”¨ `DragGesture` å®ç°
- æ‹–åŠ¨æ—¶æ›´æ–°çª—å£ä½ç½®
- é€šè¿‡ `NSApplication.shared.windows` è·å–çª—å£
- ä½¿ç”¨ `setFrameOrigin` ç§»åŠ¨çª—å£

**è¾…åŠ©æ–¹æ³•ï¼š**
- `scrollToBottom()` - æ»šåŠ¨åˆ°å¯¹è¯åº•éƒ¨
- `moveWindow(by:)` - ç§»åŠ¨çª—å£ä½ç½®

---

#### PreferencesView.swift

**ä½œç”¨ï¼š** åå¥½è®¾ç½®è§†å›¾ï¼Œæä¾›åº”ç”¨é…ç½®ç•Œé¢ã€‚

**æ ¸å¿ƒç»„ä»¶ï¼š**

##### PreferencesView (ä¸»è§†å›¾ç»“æ„ä½“)

**çŠ¶æ€å±æ€§ï¼š**
- `@ObservedObject var petViewBackend` - å® ç‰©è§†å›¾åç«¯å¼•ç”¨
- `@StateObject private var backend` - åå¥½è®¾ç½®åç«¯
- `@AppStorage` ç³»åˆ— - æŒä¹…åŒ–å­˜å‚¨çš„è®¾ç½®é¡¹
  - `apiKey` - API å¯†é’¥
  - `aiModel` - AI æ¨¡å‹åç§°
  - `systemPrompt` - ç³»ç»Ÿæç¤ºè¯
  - `apiUrl` - API åœ°å€
  - `provider` - æœåŠ¡æä¾›å•†
  - `overlapRatio` - ç•Œé¢é‡å æ¯”ä¾‹
- `@FocusState private var focusedField` - å½“å‰èšç„¦çš„å­—æ®µ

**ç•Œé¢ç»“æ„ï¼š**

ä½¿ç”¨ `NavigationSplitView` å®ç°ä¾§è¾¹æ å¯¼èˆªï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚                         â”‚
â”‚  ä¾§è¾¹æ    â”‚      è¯¦æƒ…è§†å›¾            â”‚
â”‚          â”‚                         â”‚
â”‚  é£æ ¼    â”‚   [å¯¹åº”æ ‡ç­¾é¡µå†…å®¹]       â”‚
â”‚  æ¨¡å‹è®¾ç½® â”‚                         â”‚
â”‚  å¸ƒå±€    â”‚                         â”‚
â”‚  è§’è‰²ç»‘å®š â”‚                         â”‚
â”‚  å…³äº    â”‚                         â”‚
â”‚          â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¾§è¾¹æ èœå•é¡¹ï¼š**
1. é£æ ¼ - `person.crop.circle` å›¾æ ‡
2. æ¨¡å‹è®¾ç½® - `network` å›¾æ ‡
3. å¸ƒå±€ - `rectangle.stack` å›¾æ ‡
4. è§’è‰²ç»‘å®š - `person.2.crop.square.stack` å›¾æ ‡
5. å…³äº - `info.circle` å›¾æ ‡

---

##### æ ‡ç­¾é¡µè¯¦è§£

**1. é£æ ¼è®¾ç½®æ ‡ç­¾é¡µ (styleSettingsTab)**

**ç•Œé¢ç»„ä»¶ï¼š**

a) **ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘å™¨ (SystemPromptEditor)**
   - å¤šè¡Œæ–‡æœ¬ç¼–è¾‘å™¨
   - å­—ç¬¦è®¡æ•°æ˜¾ç¤º (é™åˆ¶ 500 å­—ç¬¦)
   - è¶…é•¿è­¦å‘Šæç¤º
   - é‡ç½®ä¸ºé»˜è®¤æŒ‰é’®
   - å®æ—¶å­—ç¬¦ç»Ÿè®¡

b) **é™æ€æç¤ºè¯ç¼–è¾‘å™¨ (StaticMessagesEditor)**
   - æç¤ºè¯åˆ—è¡¨æ˜¾ç¤º
   - æ·»åŠ æ–°æç¤ºè¯
   - ç¼–è¾‘ç°æœ‰æç¤ºè¯
   - åˆ é™¤æç¤ºè¯
   - æç¤ºè¯æ•°é‡ç»Ÿè®¡
   - æ»šåŠ¨åˆ—è¡¨ï¼ˆé«˜åº¦ 150pxï¼‰

c) **æ“ä½œæŒ‰é’® (EnhancedActionButtons)**
   - ä¿å­˜æŒ‰é’®ï¼ˆä¸»è¦æ ·å¼ï¼‰
   - å–æ¶ˆæŒ‰é’®ï¼ˆæ¬¡è¦æ ·å¼ï¼‰
   - æœªä¿å­˜æ›´æ”¹æŒ‡ç¤ºå™¨ï¼ˆè„‰åŠ¨åœ†ç‚¹ï¼‰

**åŠŸèƒ½ï¼š**
- é…ç½® AI è§’è‰²çš„ä¸ªæ€§å’Œè¡Œä¸º
- è‡ªå®šä¹‰è‡ªåŠ¨å›å¤æ¶ˆæ¯
- å®æ—¶éªŒè¯è¾“å…¥
- æ˜¾ç¤ºæœªä¿å­˜æ›´æ”¹æç¤º

---

**2. æ¨¡å‹è®¾ç½®æ ‡ç­¾é¡µ (modelSettingsTab)**

**ç•Œé¢ç»„ä»¶ï¼š**

a) **æä¾›å•†é€‰æ‹©å™¨ (ProviderPicker)**
   - åˆ†æ®µæ§åˆ¶å™¨æ ·å¼
   - é€‰é¡¹: æ™ºè°±æ¸…è¨€ / é€šä¹‰åƒé—®
   - åˆ‡æ¢æ—¶è‡ªåŠ¨æ›´æ–° API åœ°å€å’Œæ¨¡å‹

b) **æ¨¡å‹å­—æ®µ (EnhancedFormField)**
   - æ–‡æœ¬è¾“å…¥æ¡†
   - å®æ—¶éªŒè¯
   - é”™è¯¯/æˆåŠŸæç¤º
   - å ä½ç¬¦æç¤º

c) **API åœ°å€å­—æ®µ**
   - æ–‡æœ¬è¾“å…¥æ¡†
   - URL æ ¼å¼éªŒè¯
   - HTTPS åè®®æ£€æŸ¥
   - é”™è¯¯/æˆåŠŸæç¤º

d) **API Key å­—æ®µ**
   - å¤šè¡Œæ–‡æœ¬ç¼–è¾‘å™¨
   - é«˜åº¦: 100px
   - éç©ºéªŒè¯
   - é»˜è®¤å€¼æ£€æŸ¥

**éªŒè¯è§„åˆ™ï¼š**
- æ¨¡å‹åç§°: ä¸èƒ½ä¸ºç©ºï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦
- API åœ°å€: å¿…é¡»æ˜¯æœ‰æ•ˆçš„ HTTPS URL
- API Key: ä¸èƒ½ä¸ºç©ºï¼Œä¸èƒ½æ˜¯é»˜è®¤å€¼

**è‡ªåŠ¨å¡«å……é€»è¾‘ï¼š**
- é€‰æ‹©"æ™ºè°±æ¸…è¨€" â†’ è‡ªåŠ¨å¡«å……æ™ºè°± API åœ°å€å’Œæ¨¡å‹
- é€‰æ‹©"é€šä¹‰åƒé—®" â†’ è‡ªåŠ¨å¡«å……é€šä¹‰ API åœ°å€å’Œæ¨¡å‹

---

**3. å¸ƒå±€è®¾ç½®æ ‡ç­¾é¡µ (layoutSettingsTab)**

**ç•Œé¢ç»„ä»¶ï¼š**

a) **é‡å é¢„è§ˆ (OverlapPreview)**
   - å¯è§†åŒ–é¢„è§ˆåŒºåŸŸ
   - æ˜¾ç¤ºä¸‰ä¸ªå±‚æ¬¡:
     - è¾“å…¥æ¡†ï¼ˆæ·¡è“è‰²ï¼‰
     - å¯¹è¯è¾“å‡ºåŒºï¼ˆæ·¡è“è‰²ï¼‰
     - å® ç‰©å›¾åƒï¼ˆæ·¡æ©™è‰²ï¼‰
   - å®æ—¶åæ˜ é‡å æ¯”ä¾‹

b) **æ»‘å—æ§åˆ¶å™¨**
   - èŒƒå›´: 0% - 100%
   - æ­¥è¿›: 1%
   - å®æ—¶é¢„è§ˆ
   - ç™¾åˆ†æ¯”æ˜¾ç¤º

**é‡å è®¡ç®—ï¼š**
```
é—´è· = 30px - (30px + 60px) Ã— overlapRatio
```
- 0%: é—´è· 30pxï¼ˆä¸é‡å ï¼‰
- 50%: é—´è· -15pxï¼ˆéƒ¨åˆ†é‡å ï¼‰
- 100%: é—´è· -60pxï¼ˆå®Œå…¨é‡å ï¼‰

---

**4. è§’è‰²ç»‘å®šæ ‡ç­¾é¡µ (characterBindingTab)**

**ç•Œé¢ç»„ä»¶ï¼š**

a) **è§’è‰²é€‰æ‹©å™¨**
   - ä¸‹æ‹‰èœå•æ ·å¼
   - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨è§’è‰²
   - åŒ…å«å†…ç½®è§’è‰²å’Œè‡ªå®šä¹‰è§’è‰²
   - è§’è‰²æ•°é‡ç»Ÿè®¡

b) **è‡ªå®šä¹‰è§’è‰²ç®¡ç†**
   - æœ€å¤šæ”¯æŒ 3 ä¸ªè‡ªå®šä¹‰è§’è‰²
   - å¯¼å…¥æŒ‰é’®ï¼ˆè§’è‰²æ•°é‡ < 3 æ—¶å¯ç”¨ï¼‰
   - è§’è‰²åˆ—è¡¨æ˜¾ç¤º:
     - è§’è‰²åç§°
     - ç«™ç«‹ GIF æ–‡ä»¶å
     - åŠ¨ä½œ GIF æ–‡ä»¶å
     - åˆ é™¤æŒ‰é’®

**å¯¼å…¥æµç¨‹ï¼š**
1. ç‚¹å‡»"å¯¼å…¥"æŒ‰é’®
2. é€‰æ‹©ç«™ç«‹ GIF æ–‡ä»¶
3. è¾“å…¥è§’è‰²åç§°
4. é€‰æ‹©æ˜¯å¦æ·»åŠ åŠ¨ä½œ GIFï¼ˆå¯é€‰ï¼‰
5. æ–‡ä»¶å¤åˆ¶åˆ°åº”ç”¨æ”¯æŒç›®å½•
6. ä¿å­˜è§’è‰²é…ç½®

**å­˜å‚¨ä½ç½®ï¼š**
```
~/Library/Application Support/[BundleID]/CustomAnimations/
```

---

**5. å…³äºæ ‡ç­¾é¡µ (aboutTab)**

**ç•Œé¢ç»„ä»¶ï¼š**
- åº”ç”¨å›¾æ ‡ï¼ˆå¿ƒå½¢å›¾æ ‡ï¼‰
- å½“å‰è§’è‰²åç§°
- ç‰ˆæœ¬å·: 1.0.0
- åº”ç”¨æè¿°
- å…³é—­æŒ‰é’®

---

##### é€šç”¨åŠŸèƒ½

**æˆåŠŸæ¶ˆæ¯æ¨ªå¹… (EnhancedSuccessBanner)**
- ä»é¡¶éƒ¨æ»‘å…¥åŠ¨ç”»
- ç»¿è‰²èƒŒæ™¯
- å¯¹å‹¾å›¾æ ‡
- 2 ç§’åè‡ªåŠ¨æ¶ˆå¤±
- æ¶ˆå¤±åå…³é—­çª—å£

**æœªä¿å­˜æ›´æ”¹æ£€æµ‹**
- å®æ—¶æ¯”è¾ƒå½“å‰å€¼ä¸ä¸´æ—¶å­˜å‚¨å€¼
- æ˜¾ç¤ºè„‰åŠ¨åœ†ç‚¹æŒ‡ç¤ºå™¨
- è­¦å‘Šç”¨æˆ·æœ‰æœªä¿å­˜çš„æ›´æ”¹

**ä¿å­˜/å–æ¶ˆæ“ä½œ**
- ä¿å­˜: éªŒè¯æ‰€æœ‰å­—æ®µ â†’ ä¿å­˜åˆ° UserDefaults â†’ æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ â†’ å…³é—­çª—å£
- å–æ¶ˆ: æ¢å¤ä¸´æ—¶å­˜å‚¨çš„å€¼ â†’ æ¸…é™¤éªŒè¯é”™è¯¯ â†’ å…³é—­çª—å£

---

### 3. ViewModels æ¨¡å— - ä¸šåŠ¡é€»è¾‘å±‚

#### PetViewBackend.swift

**ä½œç”¨ï¼š** å® ç‰©è§†å›¾çš„ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨ï¼Œç®¡ç†è§’è‰²çŠ¶æ€ã€ç”¨æˆ·äº¤äº’å’Œè‡ªåŠ¨è¡Œä¸ºã€‚

**æ ¸å¿ƒå±æ€§ï¼š**

**å¯å‘å¸ƒå±æ€§ (@Published):**
- `currentCharacter: PetCharacter` - å½“å‰é€‰ä¸­çš„è§’è‰²
- `currentGif: String` - å½“å‰æ˜¾ç¤ºçš„ GIF æ–‡ä»¶å
- `isReacting: Bool` - æ˜¯å¦æ­£åœ¨æ’­æ”¾ååº”åŠ¨ç”»
- `userInput: String` - ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬
- `isThinking: Bool` - æ˜¯å¦æ­£åœ¨ç­‰å¾… AI å“åº”
- `streamedResponse: String` - AI æµå¼å“åº”çš„ç´¯ç§¯æ–‡æœ¬

**ç§æœ‰å±æ€§:**
- `apiManager: APIManager` - API ç®¡ç†å™¨å®ä¾‹
- `periodicAutoActionTimer: AnyCancellable?` - è‡ªåŠ¨è¡Œä¸ºå®šæ—¶å™¨

---

##### æ ¸å¿ƒåŠŸèƒ½

**1. ç”Ÿå‘½å‘¨æœŸç®¡ç†**

```swift
init()
```
- æ³¨å†Œåº”ç”¨æ¿€æ´»/å¤±æ´»é€šçŸ¥
- ç›‘å¬åº”ç”¨çŠ¶æ€å˜åŒ–

```swift
onAppear()
```
- è§†å›¾å‡ºç°æ—¶å¯åŠ¨è‡ªåŠ¨è¡Œä¸ºå¾ªç¯

```swift
onDisappear()
```
- è§†å›¾æ¶ˆå¤±æ—¶å–æ¶ˆå®šæ—¶å™¨
- æ¸…ç©ºå“åº”æ–‡æœ¬

```swift
onAppDidBecomeActive()
```
- åº”ç”¨æ¿€æ´»æ—¶é‡å¯å®šæ—¶å™¨

```swift
onAppDidResignActive()
```
- åº”ç”¨å¤±æ´»æ—¶ä¿æŒå®šæ—¶å™¨è¿è¡Œï¼ˆåå°ä¹Ÿèƒ½è‡ªåŠ¨äº’åŠ¨ï¼‰

---

**2. ç”¨æˆ·äº¤äº’å¤„ç†**

**submitInput() - æäº¤ç”¨æˆ·è¾“å…¥**

åŠŸèƒ½æµç¨‹:
1. æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
2. æ£€æµ‹éŸ³ä¹æ’­æ”¾å…³é”®è¯ï¼ˆ"æˆ‘æƒ³å¬"ã€"æ’­æ”¾"ã€"æ¥ä¸€é¦–"ï¼‰
3. å¦‚æœæ˜¯éŸ³ä¹è¯·æ±‚ â†’ è°ƒç”¨ `playSongInAppleMusic()`
4. å¦åˆ™ â†’ è°ƒç”¨ `sendRequest()` å‘é€åˆ° AI

**handleTap() - å¤„ç†å® ç‰©ç‚¹å‡»**

åŠŸèƒ½æµç¨‹:
1. æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»
2. å¦‚æœæ²¡æœ‰ â†’ è°ƒç”¨ `playNextGif()`

**switchToCharacter() - åˆ‡æ¢è§’è‰²**

åŠŸèƒ½æµç¨‹:
1. åœæ­¢å½“å‰åŠ¨ç”»
2. æ›´æ–°å½“å‰è§’è‰²
3. é‡ç½®ä¸ºç«™ç«‹ GIF

---

**3. GIF åŠ¨ç”»ç®¡ç†**

**playNextGif() - æ’­æ”¾ç‚¹å‡»åŠ¨ç”»**

åŠŸèƒ½æµç¨‹:
1. åˆ‡æ¢åˆ°ç‚¹å‡» GIF
2. è®¾ç½® `isReacting = true`
3. è®¡ç®— GIF å®é™…æ—¶é•¿
4. å»¶è¿Ÿååˆ‡æ¢å›ç«™ç«‹ GIF
5. è®¾ç½® `isReacting = false`

**getGifDuration() - è®¡ç®— GIF æ—¶é•¿**

æŠ€æœ¯å®ç°:
1. è·å– GIF æ–‡ä»¶ URL
2. åˆ›å»º `CGImageSource`
3. éå†æ‰€æœ‰å¸§
4. è¯»å–æ¯å¸§çš„å»¶è¿Ÿæ—¶é—´
5. ç´¯åŠ æ€»æ—¶é•¿
6. è¿”å›æ€»æ—¶é•¿ï¼ˆé»˜è®¤ 2.0 ç§’ï¼‰

**å¸§å»¶è¿Ÿè¯»å–ä¼˜å…ˆçº§:**
1. `kCGImagePropertyGIFUnclampedDelayTime` (æœªé™åˆ¶çš„å»¶è¿Ÿ)
2. `kCGImagePropertyGIFDelayTime` (æ ‡å‡†å»¶è¿Ÿ)
3. é»˜è®¤ 0.1 ç§’

**getGifUrl() - è·å– GIF æ–‡ä»¶ URL**

æŸ¥æ‰¾ç­–ç•¥:
1. å¦‚æœè·¯å¾„ä»¥ `/` å¼€å¤´ â†’ è‡ªå®šä¹‰è§’è‰²ï¼Œä»æ–‡ä»¶ç³»ç»ŸåŠ è½½
2. å¦åˆ™ â†’ å†…ç½®è§’è‰²ï¼Œä» Bundle åŠ è½½
   - ç›´æ¥æŸ¥æ‰¾æ–‡ä»¶å
   - å»æ‰ `.gif` åç¼€æŸ¥æ‰¾
   - åœ¨ `Resources/Animations` å­ç›®å½•æŸ¥æ‰¾

---

**4. AI æ¨¡å‹é€šä¿¡**

**sendRequest() - å‘é€è¯·æ±‚åˆ° AI**

åŠŸèƒ½æµç¨‹:
1. è®¾ç½® `isThinking = true`
2. æ¸…ç©º `streamedResponse`
3. è°ƒç”¨ `apiManager.sendStreamRequest()`
4. æµå¼æ¥æ”¶å“åº”ï¼Œç´¯åŠ åˆ° `streamedResponse`
5. å®Œæˆåè®¾ç½® `isThinking = false`

---

**5. è‡ªåŠ¨è¡Œä¸ºç³»ç»Ÿ**

**startAutoActionLoop() - å¯åŠ¨è‡ªåŠ¨è¡Œä¸ºå¾ªç¯**
- è°ƒåº¦ç¬¬ä¸€æ¬¡è‡ªåŠ¨è¡Œä¸º

**scheduleNextAutoAction() - è°ƒåº¦ä¸‹ä¸€æ¬¡è‡ªåŠ¨è¡Œä¸º**

æ—¶é—´ç­–ç•¥:
- éšæœºå»¶è¿Ÿ: 270-330 ç§’ï¼ˆ4.5-5.5 åˆ†é’Ÿï¼‰
- ä½¿ç”¨ Combine çš„ `Just` å’Œ `delay`
- æ‰§è¡Œåé€’å½’è°ƒåº¦ä¸‹ä¸€æ¬¡

**performAutoAction() - æ‰§è¡Œè‡ªåŠ¨è¡Œä¸º**

åŠŸèƒ½æµç¨‹:
1. æ£€æŸ¥æ˜¯å¦æ­£åœ¨æ’­æ”¾åŠ¨ç”»
2. æ’­æ”¾ç‚¹å‡»åŠ¨ç”»
3. é€‰æ‹©æ¶ˆæ¯æ¥æº:
   - ä¼˜å…ˆ: ç”¨æˆ·è‡ªå®šä¹‰çš„é™æ€æç¤ºè¯
   - å¤‡é€‰: è§’è‰²çš„ autoMessages
4. éšæœºé€‰æ‹©ä¸€æ¡æ¶ˆæ¯æ˜¾ç¤º

**æ¶ˆæ¯é€‰æ‹©é€»è¾‘:**
```swift
if é™æ€æç¤ºè¯å­˜åœ¨ä¸”ä¸ä¸ºç©º {
    ä½¿ç”¨é™æ€æç¤ºè¯
} else {
    ä½¿ç”¨è§’è‰²çš„ autoMessages
}
```

**cancelAutoActionLoop() - å–æ¶ˆè‡ªåŠ¨è¡Œä¸ºå¾ªç¯**
- å–æ¶ˆå®šæ—¶å™¨
- é‡Šæ”¾èµ„æº

---

**6. éŸ³ä¹æ’­æ”¾åŠŸèƒ½**

**extractSongName() - æå–æ­Œæ›²åç§°**

å¤„ç†æµç¨‹:
1. ç§»é™¤å…³é”®è¯: "æˆ‘æƒ³å¬"ã€"æ’­æ”¾"ã€"æ¥ä¸€é¦–"ã€"æ¥ç‚¹"ã€"å¸®æˆ‘æ”¾"
2. ç§»é™¤å°¾ç¼€: "çš„æ­Œ"
3. å»é™¤å‰åç©ºæ ¼
4. è¿”å›çº¯å‡€çš„æ­Œæ›²å

**playSongInAppleMusic() - åœ¨ Apple Music ä¸­æ’­æ”¾**

åŠŸèƒ½æµç¨‹:
1. URL ç¼–ç æ­Œæ›²å
2. å°è¯•æ‰“å¼€ Apple Music åº”ç”¨ (`music://` åè®®)
3. å¦‚æœå¤±è´¥ï¼Œæ‰“å¼€ç½‘é¡µç‰ˆ (`https://music.apple.com`)
4. æ˜¾ç¤ºç›¸åº”çš„åé¦ˆæ¶ˆæ¯

URL æ ¼å¼:
- åº”ç”¨: `music://music.apple.com/search?term={æ­Œæ›²å}`
- ç½‘é¡µ: `https://music.apple.com/search?term={æ­Œæ›²å}`

---

#### PreferencesViewBackend.swift

**ä½œç”¨ï¼š** åå¥½è®¾ç½®è§†å›¾çš„ä¸šåŠ¡é€»è¾‘æ§åˆ¶å™¨ï¼Œç®¡ç†è®¾ç½®éªŒè¯ã€è§’è‰²ç»‘å®šå’Œæ•°æ®æŒä¹…åŒ–ã€‚

**æ ¸å¿ƒå±æ€§ï¼š**

**å¯å‘å¸ƒå±æ€§ (@Published):**
- `selectedSection: PreferenceSection?` - å½“å‰é€‰ä¸­çš„è®¾ç½®åˆ†åŒº
- `validationErrors: [String: String]` - éªŒè¯é”™è¯¯å­—å…¸
- `validationState: ValidationState` - éªŒè¯çŠ¶æ€å¯¹è±¡
- `showSuccessMessage: Bool` - æ˜¯å¦æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
- `showErrorAlert: Bool` - æ˜¯å¦æ˜¾ç¤ºé”™è¯¯è­¦å‘Š
- `errorAlertMessage: String` - é”™è¯¯è­¦å‘Šæ¶ˆæ¯
- `hasUnsavedChanges: Bool` - æ˜¯å¦æœ‰æœªä¿å­˜çš„æ›´æ”¹
- `customCharacters: [PetCharacter]` - è‡ªå®šä¹‰è§’è‰²åˆ—è¡¨
- `showImportError: Bool` - æ˜¯å¦æ˜¾ç¤ºå¯¼å…¥é”™è¯¯
- `importErrorMessage: String` - å¯¼å…¥é”™è¯¯æ¶ˆæ¯
- `staticMessages: [String]` - é™æ€æç¤ºè¯åˆ—è¡¨

**ä¸´æ—¶å­˜å‚¨å±æ€§:**
- `tempApiKey: String` - ä¸´æ—¶ API Key
- `tempAiModel: String` - ä¸´æ—¶æ¨¡å‹åç§°
- `tempSystemPrompt: String` - ä¸´æ—¶ç³»ç»Ÿæç¤ºè¯
- `tempApiUrl: String` - ä¸´æ—¶ API åœ°å€
- `tempProvider: String` - ä¸´æ—¶æä¾›å•†
- `tempOverlapRatio: Double` - ä¸´æ—¶é‡å æ¯”ä¾‹
- `tempStaticMessages: [String]` - ä¸´æ—¶é™æ€æç¤ºè¯

**ä¾èµ–é¡¹:**
- `petViewBackend: PetViewBackend` - å® ç‰©è§†å›¾åç«¯å¼•ç”¨

---

##### æ ¸å¿ƒåŠŸèƒ½

**1. åˆå§‹åŒ–**

```swift
init(petViewBackend: PetViewBackend)
```
- ä¿å­˜å® ç‰©è§†å›¾åç«¯å¼•ç”¨
- åŠ è½½è‡ªå®šä¹‰è§’è‰²
- åŠ è½½é™æ€æç¤ºè¯

---

**2. é™æ€æç¤ºè¯ç®¡ç†**

**loadStaticMessages() - åŠ è½½é™æ€æç¤ºè¯**
- ä» UserDefaults è¯»å– `"staticMessages"` é”®
- JSON è§£ç ä¸º `[String]` æ•°ç»„
- èµ‹å€¼ç»™ `staticMessages` å±æ€§

**saveStaticMessages() - ä¿å­˜é™æ€æç¤ºè¯**
- JSON ç¼–ç  `staticMessages` æ•°ç»„
- ä¿å­˜åˆ° UserDefaults çš„ `"staticMessages"` é”®

---

**3. è‡ªå®šä¹‰è§’è‰²ç®¡ç†**

**loadCustomCharacters() - åŠ è½½è‡ªå®šä¹‰è§’è‰²**
- ä» UserDefaults è¯»å– `"customCharacters"` é”®
- JSON è§£ç ä¸º `[PetCharacter]` æ•°ç»„
- èµ‹å€¼ç»™ `customCharacters` å±æ€§

**saveCustomCharacters() - ä¿å­˜è‡ªå®šä¹‰è§’è‰²**
- JSON ç¼–ç  `customCharacters` æ•°ç»„
- ä¿å­˜åˆ° UserDefaults çš„ `"customCharacters"` é”®

**importGIF() - å¯¼å…¥ GIF åˆ›å»ºè‡ªå®šä¹‰è§’è‰²**

å‚æ•°:
- `normalGif: URL?` - ç«™ç«‹ GIF æ–‡ä»¶ URL
- `clickGif: URL?` - ç‚¹å‡» GIF æ–‡ä»¶ URLï¼ˆå¯é€‰ï¼‰
- `name: String` - è§’è‰²åç§°

éªŒè¯è§„åˆ™:
1. è‡ªå®šä¹‰è§’è‰²æ•°é‡ < 3
2. è§’è‰²åç§°ä¸ä¸ºç©º
3. å¿…é¡»é€‰æ‹©ç«™ç«‹ GIF

åŠŸèƒ½æµç¨‹:
1. éªŒè¯è¾“å…¥
2. è·å–åº”ç”¨æ”¯æŒç›®å½•è·¯å¾„
3. åˆ›å»º `CustomAnimations` å­ç›®å½•
4. å¤åˆ¶ç«™ç«‹ GIF åˆ°ç›®å½•ï¼ˆæ–‡ä»¶å: `{è§’è‰²å}_ç«™ç«‹.gif`ï¼‰
5. å¦‚æœæœ‰ç‚¹å‡» GIFï¼Œå¤åˆ¶åˆ°ç›®å½•ï¼ˆæ–‡ä»¶å: `{è§’è‰²å}_åŠ¨ä½œ.gif`ï¼‰
6. åˆ›å»º `PetCharacter` å¯¹è±¡ï¼ˆä¿å­˜å®Œæ•´è·¯å¾„ï¼‰
7. æ·»åŠ åˆ° `customCharacters` æ•°ç»„
8. ä¿å­˜åˆ° UserDefaults

å­˜å‚¨è·¯å¾„:
```
~/Library/Application Support/{BundleID}/CustomAnimations/
```

**deleteCustomCharacter() - åˆ é™¤è‡ªå®šä¹‰è§’è‰²**

å‚æ•°:
- `index: Int` - è¦åˆ é™¤çš„è§’è‰²ç´¢å¼•

åŠŸèƒ½æµç¨‹:
1. éªŒè¯ç´¢å¼•æœ‰æ•ˆæ€§
2. è·å–è§’è‰²å¯¹è±¡
3. åˆ é™¤ç«™ç«‹ GIF æ–‡ä»¶
4. åˆ é™¤ç‚¹å‡» GIF æ–‡ä»¶ï¼ˆå¦‚æœä¸åŒï¼‰
5. ä»æ•°ç»„ä¸­ç§»é™¤è§’è‰²
6. ä¿å­˜åˆ° UserDefaults

---

**4. ä¸´æ—¶å€¼ç®¡ç†**

**loadTemporaryValues() - åŠ è½½å½“å‰å€¼åˆ°ä¸´æ—¶å­˜å‚¨**

ä½œç”¨:
- åœ¨è§†å›¾å‡ºç°æ—¶è°ƒç”¨
- ä¿å­˜å½“å‰æ‰€æœ‰è®¾ç½®å€¼
- ç”¨äºå–æ¶ˆæ“ä½œæ—¶æ¢å¤

**checkUnsavedChanges() - æ£€æŸ¥æœªä¿å­˜çš„æ›´æ”¹**

æ¯”è¾ƒé¡¹:
- API Key
- AI æ¨¡å‹
- ç³»ç»Ÿæç¤ºè¯
- API åœ°å€
- æä¾›å•†
- é‡å æ¯”ä¾‹
- é™æ€æç¤ºè¯

é€»è¾‘:
```swift
hasUnsavedChanges = å½“å‰å€¼ != ä¸´æ—¶å€¼
```

---

**5. éªŒè¯é€»è¾‘**

**validateAllFields() - éªŒè¯æ‰€æœ‰å­—æ®µ**

éªŒè¯é¡¹:
1. API Key éªŒè¯
2. API URL éªŒè¯
3. æ¨¡å‹åç§°éªŒè¯

è¿”å›:
- `true` - æ‰€æœ‰å­—æ®µæœ‰æ•ˆ
- `false` - å­˜åœ¨éªŒè¯é”™è¯¯

å‰¯ä½œç”¨:
- æ›´æ–° `validationErrors` å­—å…¸
- æ›´æ–° `validationState` å¯¹è±¡

**validateAPIKeyRealtime() - å®æ—¶éªŒè¯ API Key**

è§„åˆ™:
- ä¸èƒ½ä¸ºç©º
- ä¸èƒ½æ˜¯é»˜è®¤å€¼

**validateAPIURLRealtime() - å®æ—¶éªŒè¯ API URL**

è§„åˆ™:
- ä¸èƒ½ä¸ºç©º
- å¿…é¡»æ˜¯æœ‰æ•ˆçš„ URL æ ¼å¼

**validateModelRealtime() - å®æ—¶éªŒè¯æ¨¡å‹åç§°**

è§„åˆ™:
- ä¸èƒ½ä¸ºç©º
- åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦
- æ­£åˆ™è¡¨è¾¾å¼: `^[a-zA-Z0-9_-]+$`

---

**6. æä¾›å•†ç®¡ç†**

**handleProviderChange() - å¤„ç†æä¾›å•†åˆ‡æ¢**

å‚æ•°:
- `newProvider: String` - æ–°çš„æä¾›å•†
- `currentApiUrl: String` - å½“å‰ API åœ°å€
- `currentModel: String` - å½“å‰æ¨¡å‹åç§°

è¿”å›:
- `(apiUrl: String, model: String)` - æ›´æ–°åçš„å€¼

é€»è¾‘:

**åˆ‡æ¢åˆ°æ™ºè°±æ¸…è¨€:**
- API åœ°å€ â†’ `https://open.bigmodel.cn/api/paas/v4/chat/completions`
- æ¨¡å‹åç§° â†’ `glm-4v-flash`

**åˆ‡æ¢åˆ°é€šä¹‰åƒé—®:**
- API åœ°å€ â†’ `https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation`
- æ¨¡å‹åç§° â†’ `qwen-turbo`

---

**7. ä¿å­˜å’Œå–æ¶ˆæ“ä½œ**

**saveSettings() - ä¿å­˜è®¾ç½®**

å‚æ•°:
- `apiKey: String`
- `apiUrl: String`
- `aiModel: String`
- `onSuccess: () -> Void` - æˆåŠŸå›è°ƒ
- `onDismiss: () -> Void` - å…³é—­å›è°ƒ

åŠŸèƒ½æµç¨‹:
1. éªŒè¯æ‰€æœ‰å­—æ®µ
2. å¦‚æœéªŒè¯å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯è­¦å‘Š
3. ä¿å­˜é™æ€æç¤ºè¯
4. è°ƒç”¨æˆåŠŸå›è°ƒï¼ˆæ›´æ–°ä¸´æ—¶å€¼ï¼‰
5. å‘é€ `"SettingsChanged"` é€šçŸ¥
6. æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼ˆåŠ¨ç”»ï¼‰
7. 2 ç§’åéšè—æˆåŠŸæ¶ˆæ¯
8. 0.3 ç§’åè°ƒç”¨å…³é—­å›è°ƒ

**cancelChanges() - å–æ¶ˆæ›´æ”¹**

åŠŸèƒ½æµç¨‹:
1. æ¸…ç©ºéªŒè¯é”™è¯¯
2. æ¸…ç©ºéªŒè¯çŠ¶æ€
3. æ¢å¤é™æ€æç¤ºè¯
4. è®¾ç½® `hasUnsavedChanges = false`

æ³¨æ„: å®é™…çš„å€¼æ¢å¤åœ¨ `PreferencesView` ä¸­å®Œæˆ

---

**8. è§’è‰²ç®¡ç†**

**switchCharacter() - åˆ‡æ¢è§’è‰²**

å‚æ•°:
- `index: Int` - è§’è‰²ç´¢å¼•

åŠŸèƒ½:
- è·å–æŒ‡å®šç´¢å¼•çš„è§’è‰²
- è°ƒç”¨ `petViewBackend.switchToCharacter()`

**getCurrentCharacterIndex() - è·å–å½“å‰è§’è‰²ç´¢å¼•**

è¿”å›:
- å½“å‰è§’è‰²åœ¨ `availableCharacters` ä¸­çš„ç´¢å¼•
- å¦‚æœæ‰¾ä¸åˆ°è¿”å› 0

---

##### PreferenceSection æšä¸¾

**å®šä¹‰è®¾ç½®åˆ†åŒº:**

```swift
enum PreferenceSection: String, CaseIterable, Identifiable {
    case style = "é£æ ¼"
    case model = "æ¨¡å‹è®¾ç½®"
    case layout = "å¸ƒå±€"
    case characterBinding = "è§’è‰²ç»‘å®š"
    case about = "å…³äº"
}
```

**å›¾æ ‡æ˜ å°„:**
- é£æ ¼: `person.crop.circle`
- æ¨¡å‹è®¾ç½®: `network`
- å¸ƒå±€: `rectangle.stack`
- è§’è‰²ç»‘å®š: `person.2.crop.square.stack`
- å…³äº: `info.circle`

---

### 4. Models æ¨¡å— - æ•°æ®æ¨¡å‹å±‚

#### PreferencesModels.swift

**ä½œç”¨ï¼š** å®šä¹‰åå¥½è®¾ç½®ç›¸å…³çš„æ•°æ®æ¨¡å‹ã€éªŒè¯é€»è¾‘å’Œ UI ç»„ä»¶ã€‚

---

##### æ•°æ®æ¨¡å‹

**1. ValidationError - éªŒè¯é”™è¯¯æšä¸¾**

```swift
enum ValidationError: LocalizedError {
    case emptyAPIKey
    case invalidAPIKey
    case invalidURL
    case emptyModel
    case networkError(String)
}
```

**é”™è¯¯æè¿°:**
- `emptyAPIKey` - "API å¯†é’¥ä¸èƒ½ä¸ºç©º"
- `invalidAPIKey` - "API å¯†é’¥æ ¼å¼æ— æ•ˆæˆ–ä¸ºé»˜è®¤å€¼"
- `invalidURL` - "API åœ°å€å¿…é¡»æ˜¯æœ‰æ•ˆçš„ HTTPS URL"
- `emptyModel` - "æ¨¡å‹åç§°ä¸èƒ½ä¸ºç©º"
- `networkError` - "ç½‘ç»œé”™è¯¯: {æ¶ˆæ¯}"

---

**2. PreferencesData - åå¥½è®¾ç½®æ•°æ®ç»“æ„**

```swift
struct PreferencesData: Equatable {
    var apiKey: String
    var aiModel: String
    var systemPrompt: String
    var apiUrl: String
    var provider: String
    var overlapRatio: Double
    var staticMessages: [String]
}
```

**é»˜è®¤å€¼:**
- `apiKey` - ç©ºå­—ç¬¦ä¸²
- `aiModel` - "glm-4v-flash"
- `systemPrompt` - "ä½ çš„åå­—å«å¸ƒå¶ç†ŠÂ·è§…è¯­ï¼Œç”¨80%å¯çˆ±å’Œ20%å‚²å¨‡çš„é£æ ¼å›ç­”é—®é¢˜ï¼Œåœ¨å›ç­”é—®é¢˜å‰éƒ½è¦è¯´ï¼šæŒ‡æŒ¥å®˜ï¼Œä½ å¥½ã€‚"
- `apiUrl` - "https://open.bigmodel.cn/api/paas/v4/chat/completions"
- `provider` - "zhipu"
- `overlapRatio` - 0.3
- `staticMessages` - ç©ºæ•°ç»„

---

**3. ValidationState - éªŒè¯çŠ¶æ€ç»“æ„**

```swift
struct ValidationState {
    var apiKeyError: String?
    var apiUrlError: String?
    var modelError: String?
}
```

**å±æ€§:**
- `isValid: Bool` - æ‰€æœ‰å­—æ®µæ˜¯å¦æœ‰æ•ˆï¼ˆè®¡ç®—å±æ€§ï¼‰

**æ–¹æ³•:**

**validateAPIKey()**
- æ£€æŸ¥æ˜¯å¦ä¸ºç©º
- è¿”å›éªŒè¯ç»“æœ
- æ›´æ–° `apiKeyError`

**validateAPIURL()**
- æ£€æŸ¥æ˜¯å¦ä¸ºç©º
- è¿”å›éªŒè¯ç»“æœ
- æ›´æ–° `apiUrlError`

**validateModel()**
- æ£€æŸ¥æ˜¯å¦ä¸ºç©º
- æ£€æŸ¥æ ¼å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
- è¿”å›éªŒè¯ç»“æœ
- æ›´æ–° `modelError`

**clearErrors()**
- æ¸…ç©ºæ‰€æœ‰é”™è¯¯æ¶ˆæ¯

---

##### å¸ƒå±€å¸¸é‡

**LayoutConstants - ç»Ÿä¸€çš„å¸ƒå±€å¸¸é‡**

**é—´è·:**
- `sectionSpacing: 20` - åˆ†åŒºé—´è·
- `fieldSpacing: 12` - å­—æ®µé—´è·
- `horizontalPadding: 20` - æ°´å¹³å†…è¾¹è·
- `verticalPadding: 16` - å‚ç›´å†…è¾¹è·

**å°ºå¯¸:**
- `textFieldWidth: 360` - æ–‡æœ¬æ¡†å®½åº¦
- `textEditorMinHeight: 100` - æ–‡æœ¬ç¼–è¾‘å™¨æœ€å°é«˜åº¦
- `systemPromptHeight: 180` - ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘å™¨é«˜åº¦
- `windowMinWidth: 500` - çª—å£æœ€å°å®½åº¦
- `windowMinHeight: 400` - çª—å£æœ€å°é«˜åº¦

**æ ·å¼:**
- `cornerRadius: 8` - åœ†è§’åŠå¾„
- `borderWidth: 1` - è¾¹æ¡†å®½åº¦

---

##### é¢œè‰²æ‰©å±•

**Color æ‰©å±• - ç»Ÿä¸€çš„é¢œè‰²æ–¹æ¡ˆ**

```swift
extension Color {
    static let formBackground = Color(NSColor.controlBackgroundColor)
    static let errorRed = Color.red.opacity(0.8)
    static let successGreen = Color.green.opacity(0.8)
    static let warningYellow = Color.yellow.opacity(0.8)
    static let borderGray = Color.gray.opacity(0.3)
    static let focusBorderBlue = Color.blue.opacity(0.5)
}
```

---

##### å­—ä½“æ ·å¼

**FontStyles - ç»Ÿä¸€çš„å­—ä½“æ ·å¼**

```swift
struct FontStyles {
    static let sectionTitle = Font.headline
    static let fieldLabel = Font.body
    static let fieldInput = Font.system(size: 14)
    static let errorMessage = Font.caption
    static let characterCount = Font.caption.monospacedDigit()
}
```

---

##### UI ç»„ä»¶

**1. SystemPromptEditor - ç³»ç»Ÿæç¤ºè¯ç¼–è¾‘å™¨**

**å±æ€§:**
- `@Binding var text: String` - ç»‘å®šçš„æ–‡æœ¬
- `characterLimit: Int = 500` - å­—ç¬¦é™åˆ¶
- `defaultPrompt: String` - é»˜è®¤æç¤ºè¯
- `focusedField: FocusState.Binding` - ç„¦ç‚¹ç»‘å®š

**ç•Œé¢å…ƒç´ :**
- æ ‡ç­¾å’Œå­—ç¬¦è®¡æ•°
- å¤šè¡Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆé«˜åº¦ 180ptï¼‰
- è¶…é•¿è­¦å‘Šï¼ˆé»„è‰²ï¼‰
- é‡ç½®æŒ‰é’®

**åŠŸèƒ½:**
- å®æ—¶å­—ç¬¦è®¡æ•°
- è¶…è¿‡é™åˆ¶æ—¶æ˜¾ç¤ºè­¦å‘Š
- ä¸€é”®é‡ç½®ä¸ºé»˜è®¤å€¼

---

**2. StaticMessagesEditor - é™æ€æç¤ºè¯ç¼–è¾‘å™¨**

**å±æ€§:**
- `@Binding var messages: [String]` - æç¤ºè¯åˆ—è¡¨
- `@State private var newMessage: String` - æ–°æ¶ˆæ¯è¾“å…¥
- `@State private var editingIndex: Int?` - ç¼–è¾‘ä¸­çš„ç´¢å¼•
- `@State private var editingText: String` - ç¼–è¾‘ä¸­çš„æ–‡æœ¬

**ç•Œé¢å…ƒç´ :**

a) **æ ‡é¢˜å’Œè®¡æ•°**
   - æ˜¾ç¤º "é™æ€æç¤ºè¯:"
   - æ˜¾ç¤ºæ¶ˆæ¯æ•°é‡ "[X æ¡]"

b) **æ¶ˆæ¯åˆ—è¡¨**ï¼ˆé«˜åº¦ 150pxï¼‰
   - åºå·æ˜¾ç¤ºï¼ˆ1. 2. 3. ...ï¼‰
   - æ¶ˆæ¯å†…å®¹æˆ–ç¼–è¾‘æ¡†
   - æ“ä½œæŒ‰é’®:
     - ç¼–è¾‘æ¨¡å¼: âœ“ ä¿å­˜ã€âœ— å–æ¶ˆ
     - æŸ¥çœ‹æ¨¡å¼: âœï¸ ç¼–è¾‘ã€ğŸ—‘ï¸ åˆ é™¤

c) **æ·»åŠ æ–°æ¶ˆæ¯**
   - æ–‡æœ¬è¾“å…¥æ¡†
   - â• æ·»åŠ æŒ‰é’®ï¼ˆç©ºè¾“å…¥æ—¶ç¦ç”¨ï¼‰

d) **è¯´æ˜æ–‡å­—**
   - "é™æ€æç¤ºè¯å°†æ›¿ä»£ gif_library.swift ä¸­çš„ autoMessages"

**åŠŸèƒ½:**
- æ·»åŠ æ–°æç¤ºè¯
- ç¼–è¾‘ç°æœ‰æç¤ºè¯
- åˆ é™¤æç¤ºè¯
- ç©ºåˆ—è¡¨æç¤º

---

**3. Provider - æœåŠ¡æä¾›å•†æ¨¡å‹**

```swift
struct Provider: Identifiable {
    let id: String
    let name: String
}
```

**å¯ç”¨æä¾›å•†:**
- `id: "zhipu"`, `name: "æ™ºè°±æ¸…è¨€"`
- `id: "qwen"`, `name: "é€šä¹‰åƒé—®"`

---

**4. ProviderPicker - æä¾›å•†é€‰æ‹©å™¨**

**å±æ€§:**
- `@Binding var selectedProvider: String` - é€‰ä¸­çš„æä¾›å•† ID
- `providers: [Provider]` - æä¾›å•†åˆ—è¡¨

**ç•Œé¢:**
- æ ‡ç­¾: "é€‰æ‹©å¹³å°ï¼š"
- åˆ†æ®µæ§åˆ¶å™¨ï¼ˆSegmentedPickerStyleï¼‰
- å®½åº¦: 360pt

---

**5. EnhancedFormField - å¢å¼ºè¡¨å•å­—æ®µ**

**å±æ€§:**
- `label: String` - å­—æ®µæ ‡ç­¾
- `errorMessage: String?` - é”™è¯¯æ¶ˆæ¯
- `successMessage: String?` - æˆåŠŸæ¶ˆæ¯
- `content: Content` - å­—æ®µå†…å®¹è§†å›¾
- `@State private var showSuccess: Bool` - æ˜¯å¦æ˜¾ç¤ºæˆåŠŸçŠ¶æ€

**ç•Œé¢å…ƒç´ :**
- æ ‡ç­¾æ–‡æœ¬
- å†…å®¹è§†å›¾
- è¾¹æ¡†ï¼ˆæ ¹æ®çŠ¶æ€å˜è‰²ï¼‰
- é”™è¯¯æ¶ˆæ¯ï¼ˆçº¢è‰²ï¼Œå¸¦è­¦å‘Šå›¾æ ‡ï¼‰
- æˆåŠŸæ¶ˆæ¯ï¼ˆç»¿è‰²ï¼Œå¸¦å¯¹å‹¾å›¾æ ‡ï¼Œ2 ç§’åæ¶ˆå¤±ï¼‰

**è¾¹æ¡†é¢œè‰²:**
- é”™è¯¯: çº¢è‰²
- æˆåŠŸ: ç»¿è‰²
- æ­£å¸¸: é€æ˜

**åŠ¨ç”»:**
- è¾¹æ¡†é¢œè‰²å˜åŒ–: æŸ”å’ŒåŠ¨ç”»
- æˆåŠŸæ¶ˆæ¯: æ·¡å…¥æ·¡å‡º + ç¼©æ”¾

---

**6. EnhancedActionButtons - å¢å¼ºæ“ä½œæŒ‰é’®ç»„**

**å±æ€§:**
- `onSave: () -> Void` - ä¿å­˜å›è°ƒ
- `onCancel: () -> Void` - å–æ¶ˆå›è°ƒ
- `isSaveDisabled: Bool` - ä¿å­˜æŒ‰é’®æ˜¯å¦ç¦ç”¨
- `hasUnsavedChanges: Bool` - æ˜¯å¦æœ‰æœªä¿å­˜æ›´æ”¹
- `@State private var pulseAnimation: CGFloat` - è„‰åŠ¨åŠ¨ç”»çŠ¶æ€

**ç•Œé¢å…ƒç´ :**

a) **æœªä¿å­˜æ›´æ”¹æŒ‡ç¤ºå™¨**ï¼ˆæ¡ä»¶æ˜¾ç¤ºï¼‰
   - è„‰åŠ¨åœ†ç‚¹ï¼ˆæ©™è‰²ï¼‰
   - æ–‡å­—: "æœªä¿å­˜çš„æ›´æ”¹"
   - åŠ¨ç”»: 1.0 â†” 1.3 ç¼©æ”¾å¾ªç¯

b) **å–æ¶ˆæŒ‰é’®**
   - æ¬¡è¦æ ·å¼
   - å§‹ç»ˆå¯ç”¨

c) **ä¿å­˜æŒ‰é’®**
   - ä¸»è¦æ ·å¼
   - æ ¹æ®éªŒè¯çŠ¶æ€ç¦ç”¨

---

**7. EnhancedSuccessBanner - æˆåŠŸæ¨ªå¹…**

**å±æ€§:**
- `message: String` - æˆåŠŸæ¶ˆæ¯
- `@State private var offset: CGFloat` - å‚ç›´åç§»
- `@State private var opacity: Double` - é€æ˜åº¦

**ç•Œé¢:**
- å¯¹å‹¾å›¾æ ‡ï¼ˆç™½è‰²ï¼‰
- æ¶ˆæ¯æ–‡æœ¬ï¼ˆç™½è‰²ï¼‰
- ç»¿è‰²èƒŒæ™¯
- åœ†è§’çŸ©å½¢
- é˜´å½±æ•ˆæœ

**åŠ¨ç”»:**
- å‡ºç°: ä» -100 æ»‘å…¥åˆ° 8
- é€æ˜åº¦: 0 â†’ 1
- ä½¿ç”¨å¼¹ç°§åŠ¨ç”»

---

**8. OverlapPreview - é‡å é¢„è§ˆç»„ä»¶**

**å±æ€§:**
- `overlapRatio: Double` - é‡å æ¯”ä¾‹

**ç•Œé¢å…ƒç´ :**

a) **è¾“å…¥æ¡†é¢„è§ˆ**ï¼ˆæ·¡è“è‰²ï¼‰
   - é«˜åº¦: 24pt
   - æ–‡å­—: "è¾“å…¥æ¡†"

b) **å¯¹è¯è¾“å‡ºåŒºé¢„è§ˆ**ï¼ˆæ·¡è“è‰²ï¼‰
   - é«˜åº¦: 60pt
   - æ–‡å­—: "å¯¹è¯è¾“å‡ºåŒºåŸŸ / Chat Output"
   - é˜´å½±æ•ˆæœ

c) **å® ç‰©å›¾åƒé¢„è§ˆ**ï¼ˆæ·¡æ©™è‰²ï¼‰
   - é«˜åº¦: 80pt
   - å¿ƒå½¢å›¾æ ‡
   - æ–‡å­—: "å® ç‰©å›¾åƒ"
   - é˜´å½±æ•ˆæœ

**å¸ƒå±€è®¡ç®—:**
```swift
let inputHeight = 24
let chatHeight = 60
let petHeight = 80
let inputChatSpacing = 8
let noOverlapSpacing = 30
let maxOverlap = chatHeight + noOverlapSpacing
let overlapAmount = maxOverlap * overlapRatio
```

**é—´è·å…¬å¼:**
```
å® ç‰©å›¾åƒä½ç½® = chatHeight + noOverlapSpacing - overlapAmount
```

**æ•ˆæœ:**
- 0%: é—´è· 30px
- 50%: é—´è· -15px
- 100%: é—´è· -60px

---

### 5. Services æ¨¡å— - æœåŠ¡å±‚

#### APIManager.swift

**ä½œç”¨ï¼š** ç®¡ç†ä¸ AI æœåŠ¡çš„ HTTP é€šä¿¡ï¼Œæ”¯æŒæµå¼å“åº”ã€‚

**æ ¸å¿ƒå±æ€§:**
- æ— æŒä¹…åŒ–å±æ€§ï¼ˆçº¯åŠŸèƒ½ç±»ï¼‰

---

##### æ ¸å¿ƒåŠŸèƒ½

**sendStreamRequest() - å‘é€æµå¼è¯·æ±‚**

**å‚æ•°:**
- `userInput: String` - ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬
- `onReceive: @escaping (String) -> Void` - æ¥æ”¶åˆ°æ–°å†…å®¹çš„å›è°ƒ
- `onComplete: @escaping () -> Void` - è¯·æ±‚å®Œæˆçš„å›è°ƒ

**åŠŸèƒ½æµç¨‹:**

1. **è¯»å–é…ç½®**
   - ä» UserDefaults è¯»å–:
     - `apiKey` - API å¯†é’¥
     - `apiUrl` - API åœ°å€
     - `aiModel` - æ¨¡å‹åç§°
     - `systemPrompt` - ç³»ç»Ÿæç¤ºè¯
     - `provider` - æœåŠ¡æä¾›å•†

2. **æ„å»ºè¯·æ±‚ä½“**

   **æ™ºè°±æ¸…è¨€æ ¼å¼:**
   ```json
   {
     "model": "glm-4v-flash",
     "messages": [
       {"role": "system", "content": "ç³»ç»Ÿæç¤ºè¯"},
       {"role": "user", "content": "ç”¨æˆ·è¾“å…¥"}
     ],
     "stream": true
   }
   ```

   **é€šä¹‰åƒé—®æ ¼å¼:**
   ```json
   {
     "model": "qwen-turbo",
     "input": {
       "messages": [
         {"role": "system", "content": "ç³»ç»Ÿæç¤ºè¯"},
         {"role": "user", "content": "ç”¨æˆ·è¾“å…¥"}
       ]
     },
     "parameters": {
       "result_format": "message",
       "incremental_output": true
     }
   }
   ```

3. **åˆ›å»º URLRequest**
   - URL: ä»é…ç½®è¯»å–
   - æ–¹æ³•: POST
   - è¯·æ±‚å¤´:
     - `Content-Type: application/json`
     - `Authorization: Bearer {apiKey}` (æ™ºè°±)
     - `Authorization: Bearer {apiKey}` (é€šä¹‰)

4. **å‘é€è¯·æ±‚**
   - ä½¿ç”¨ `URLSession.shared.dataTask`
   - æ¥æ”¶æµå¼æ•°æ®

5. **è§£æå“åº”**

   **æ™ºè°±æ¸…è¨€å“åº”æ ¼å¼:**
   ```json
   data: {"choices":[{"delta":{"content":"æ–‡æœ¬"}}]}
   ```

   **é€šä¹‰åƒé—®å“åº”æ ¼å¼:**
   ```json
   data: {"output":{"choices":[{"message":{"content":"æ–‡æœ¬"}}]}}
   ```

6. **å¤„ç†æ•°æ®æµ**
   - æŒ‰è¡Œåˆ†å‰²æ•°æ®
   - è¿‡æ»¤ `data:` å‰ç¼€
   - è·³è¿‡ `[DONE]` æ ‡è®°
   - JSON è§£æ
   - æå–å†…å®¹
   - è°ƒç”¨ `onReceive` å›è°ƒ

7. **å®Œæˆå¤„ç†**
   - è°ƒç”¨ `onComplete` å›è°ƒ

**é”™è¯¯å¤„ç†:**
- ç½‘ç»œé”™è¯¯: æ‰“å°é”™è¯¯ä¿¡æ¯
- JSON è§£æé”™è¯¯: è·³è¿‡è¯¥è¡Œ
- ç©ºå†…å®¹: è·³è¿‡

**è°ƒè¯•è¾“å‡º:**
- è¯·æ±‚ URL
- è¯·æ±‚ä½“
- å“åº”æ•°æ®
- è§£æç»“æœ

---

##### æ•°æ®è§£æé€»è¾‘

**æ™ºè°±æ¸…è¨€:**
```swift
if let choices = json["choices"] as? [[String: Any]],
   let delta = choices.first?["delta"] as? [String: Any],
   let content = delta["content"] as? String {
    onReceive(content)
}
```

**é€šä¹‰åƒé—®:**
```swift
if let output = json["output"] as? [String: Any],
   let choices = output["choices"] as? [[String: Any]],
   let message = choices.first?["message"] as? [String: Any],
   let content = message["content"] as? String {
    onReceive(content)
}
```

---

##### ä½¿ç”¨ç¤ºä¾‹

```swift
apiManager.sendStreamRequest(userInput: "ä½ å¥½") { newContent in
    // æ¥æ”¶åˆ°æ–°å†…å®¹
    self.streamedResponse += newContent
} onComplete: {
    // è¯·æ±‚å®Œæˆ
    self.isThinking = false
}
```

---

### 6. Utils æ¨¡å— - å·¥å…·ç±»

#### gif_library.swift

**ä½œç”¨ï¼š** ç®¡ç†è§’è‰²æ•°æ®å’Œè§’è‰²åº“ã€‚

---

##### æ•°æ®æ¨¡å‹

**PetCharacter - å® ç‰©è§’è‰²æ•°æ®æ¨¡å‹**

```swift
struct PetCharacter: Codable {
    let name: String
    let normalGif: String
    let clickGif: String
    let autoMessages: [String]
}
```

**å±æ€§è¯´æ˜:**
- `name` - è§’è‰²åç§°
- `normalGif` - ç«™ç«‹çŠ¶æ€çš„ GIF æ–‡ä»¶åæˆ–è·¯å¾„
- `clickGif` - ç‚¹å‡»åŠ¨ä½œçš„ GIF æ–‡ä»¶åæˆ–è·¯å¾„
- `autoMessages` - è‡ªåŠ¨å›å¤æ¶ˆæ¯åˆ—è¡¨

**Codable åè®®:**
- æ”¯æŒ JSON ç¼–ç /è§£ç 
- ç”¨äºè‡ªå®šä¹‰è§’è‰²çš„æŒä¹…åŒ–å­˜å‚¨

---

##### å†…ç½®è§’è‰²

**1. puppetBear - å¸ƒå¶ç†ŠÂ·è§…è¯­**

```swift
let puppetBear = PetCharacter(
    name: "å¸ƒå¶ç†ŠÂ·è§…è¯­",
    normalGif: "å¸ƒå¶ç†Šç«™ç«‹é€æ˜.gif",
    clickGif: "å¸ƒå¶ç†ŠåŠ¨ä½œé€æ˜.gif",
    autoMessages: [...]
)
```

**è‡ªåŠ¨æ¶ˆæ¯åˆ—è¡¨:**ï¼ˆ7 æ¡ï¼‰
1. "æŒ‡æŒ¥å®˜ï¼Œä½ å¥½ï½(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)äººå®¶ç­‰äº†å¥½ä¹…éƒ½æ²¡æœ‰æ”¶åˆ°ä½ çš„æ¶ˆæ¯å‘¢â€¦â€¦"
2. "(ã¤ï¹<ã€‚) å‘œå‘œâ€¦â€¦æŒ‡æŒ¥å®˜å¥½ä¹…éƒ½æ²¡æ¥çœ‹è§…è¯­äº†ï½"
3. "å“¼ï¼æŒ‡æŒ¥å®˜éƒ½ä¸ç†äººäº†ï¼Œéš¾é“æ˜¯äº¤äº†æ–°çš„AIåŠ©æ‰‹äº†å—ï¼Ÿ"
4. "å‘¼â€¦â€¦è™½ç„¶æœ‰ç‚¹å¯‚å¯ï¼Œä½†è§…è¯­çŸ¥é“ï¼ŒæŒ‡æŒ¥å®˜ä¸€å®šè¿˜ä¼šå›æ¥çš„ï½"
5. "å¸ƒå¶ç†ŠÂ·è§…è¯­éšæ—¶é™ªä¼´æŒ‡æŒ¥å®˜å“¦ï½(à¹‘á´–â—¡á´–à¹‘)â™ª"
6. "æŒ‡æŒ¥å®˜ï¼Œä½ å¥½ï½è™½ç„¶ä½ æ¶ˆå¤±å¾—å¥½ä¹…å¥½ä¹…â€¦â€¦ä½†è§…è¯­ä¸€ç‚¹éƒ½æ²¡å·æ‡’å“¦ï½"
7. "æŒ‡æŒ¥å®˜ï¼Œä½ å¥½ï½(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)è§…è¯­å·²ç»æ•°äº†å¥½å¤šå¥½å¤šé¢—æ˜Ÿæ˜Ÿäº†..."

**è§’è‰²ç‰¹ç‚¹:**
- å¯çˆ±é£æ ¼
- å¸¦æœ‰å‚²å¨‡å…ƒç´ 
- ä½¿ç”¨é¢œæ–‡å­—è¡¨æƒ…
- ç§°å‘¼ç”¨æˆ·ä¸º"æŒ‡æŒ¥å®˜"

---

**2. puppetCat - å¤æé›…**

```swift
let puppetCat = PetCharacter(
    name: "å¤æé›…",
    normalGif: "å¤æé›….gif",
    clickGif: "å¤æé›….gif",
    autoMessages: [...]
)
```

**è‡ªåŠ¨æ¶ˆæ¯åˆ—è¡¨:**ï¼ˆ2 æ¡ï¼‰
1. "å–µ~ è½»è¯­æ¥é™ªä½ å•¦~"
2. "ä¸å¯ä»¥å†·è½çŒ«çŒ«å“Ÿ~"

**è§’è‰²ç‰¹ç‚¹:**
- çŒ«å¨˜é£æ ¼
- ä½¿ç”¨"å–µ"è¯­æ°”è¯
- ç«™ç«‹å’Œç‚¹å‡»ä½¿ç”¨åŒä¸€ä¸ª GIF

---

##### è§’è‰²åº“ç®¡ç†

**availableCharacters - å†…ç½®è§’è‰²åˆ—è¡¨**

```swift
let availableCharacters: [PetCharacter] = [puppetBear, puppetCat]
```

**ä½œç”¨:**
- å­˜å‚¨æ‰€æœ‰å†…ç½®è§’è‰²
- ç”¨äºè§’è‰²é€‰æ‹©å™¨
- ç”¨äºè§’è‰²åˆ‡æ¢

---

**getAllCharacters() - è·å–æ‰€æœ‰è§’è‰²**

```swift
func getAllCharacters() -> [PetCharacter]
```

**åŠŸèƒ½:**
1. ä»å†…ç½®è§’è‰²åˆ—è¡¨å¼€å§‹
2. ä» UserDefaults è¯»å–è‡ªå®šä¹‰è§’è‰²
3. åˆå¹¶ä¸¤ä¸ªåˆ—è¡¨
4. è¿”å›å®Œæ•´çš„è§’è‰²åˆ—è¡¨

**è¿”å›å€¼:**
- å†…ç½®è§’è‰² + è‡ªå®šä¹‰è§’è‰²

**ä½¿ç”¨åœºæ™¯:**
- è§’è‰²é€‰æ‹©å™¨
- è§’è‰²æ•°é‡ç»Ÿè®¡
- è§’è‰²åˆ‡æ¢

---

##### æ•°æ®å­˜å‚¨

**UserDefaults é”®:**
- `"customCharacters"` - è‡ªå®šä¹‰è§’è‰²åˆ—è¡¨

**å­˜å‚¨æ ¼å¼:**
- JSON ç¼–ç çš„ `[PetCharacter]` æ•°ç»„

**ç¤ºä¾‹:**
```json
[
  {
    "name": "è‡ªå®šä¹‰è§’è‰²",
    "normalGif": "/path/to/normal.gif",
    "clickGif": "/path/to/click.gif",
    "autoMessages": ["æ¶ˆæ¯1", "æ¶ˆæ¯2"]
  }
]
```

---

## ç•Œé¢è®¾è®¡ç³»ç»Ÿ

### DesignSystem.swift

**ä½œç”¨ï¼š** æä¾›ç»Ÿä¸€çš„è®¾è®¡ä»¤ç‰Œå’Œæ ·å¼ç³»ç»Ÿï¼Œç¡®ä¿ç•Œé¢ä¸€è‡´æ€§ã€‚

---

#### 1. DesignColors - é¢œè‰²ç³»ç»Ÿ

**ä¸»è¦é¢œè‰²:**
- `primary` - è“è‰²ï¼ˆä¸»å“ç‰Œè‰²ï¼‰
- `primaryHover` - è“è‰² 80% é€æ˜åº¦ï¼ˆæ‚¬åœçŠ¶æ€ï¼‰
- `primaryActive` - è“è‰² 60% é€æ˜åº¦ï¼ˆæ¿€æ´»çŠ¶æ€ï¼‰

**æ¬¡è¦é¢œè‰²:**
- `secondary` - ç°è‰²
- `accent` - ç²‰è‰²ï¼ˆå¼ºè°ƒè‰²ï¼‰

**è¯­ä¹‰é¢œè‰²:**
- `success` - ç»¿è‰² 80% é€æ˜åº¦ï¼ˆæˆåŠŸçŠ¶æ€ï¼‰
- `warning` - é»„è‰² 80% é€æ˜åº¦ï¼ˆè­¦å‘ŠçŠ¶æ€ï¼‰
- `error` - çº¢è‰² 80% é€æ˜åº¦ï¼ˆé”™è¯¯çŠ¶æ€ï¼‰
- `info` - è“è‰² 80% é€æ˜åº¦ï¼ˆä¿¡æ¯çŠ¶æ€ï¼‰

**èƒŒæ™¯å’Œè¡¨é¢é¢œè‰²:**
- `surfaceLight` - ç™½è‰² 20% é€æ˜åº¦ï¼ˆæµ…è‰²è¡¨é¢ï¼‰
- `surfaceMedium` - ç™½è‰² 30% é€æ˜åº¦ï¼ˆä¸­ç­‰è¡¨é¢ï¼‰
- `surfaceHeavy` - ç™½è‰² 40% é€æ˜åº¦ï¼ˆæ·±è‰²è¡¨é¢ï¼‰

**æ–‡æœ¬é¢œè‰²:**
- `textPrimary` - ä¸»è¦æ–‡æœ¬è‰²
- `textSecondary` - æ¬¡è¦æ–‡æœ¬è‰²
- `textOnSurface` - ç™½è‰²ï¼ˆè¡¨é¢ä¸Šçš„æ–‡æœ¬ï¼‰

**è¾¹æ¡†å’Œåˆ†éš”çº¿é¢œè‰²:**
- `border` - ç°è‰² 30% é€æ˜åº¦ï¼ˆé»˜è®¤è¾¹æ¡†ï¼‰
- `borderFocus` - è“è‰² 50% é€æ˜åº¦ï¼ˆç„¦ç‚¹è¾¹æ¡†ï¼‰
- `borderError` - çº¢è‰² 80% é€æ˜åº¦ï¼ˆé”™è¯¯è¾¹æ¡†ï¼‰

---

#### 2. DesignSpacing - é—´è·ç³»ç»Ÿ

**æ ‡å‡†é—´è·å€¼:**
- `xs: 4pt` - è¶…å°é—´è·
- `sm: 8pt` - å°é—´è·
- `md: 12pt` - ä¸­ç­‰é—´è·
- `lg: 16pt` - å¤§é—´è·
- `xl: 20pt` - è¶…å¤§é—´è·
- `xxl: 24pt` - ç‰¹å¤§é—´è·

**ä½¿ç”¨åœºæ™¯:**
- ç»„ä»¶å†…è¾¹è·
- ç»„ä»¶é—´è·
- å¸ƒå±€é—´è·
- æ …æ ¼ç³»ç»Ÿ

---

#### 3. DesignAnimation - åŠ¨ç”»ç³»ç»Ÿ

**åŠ¨ç”»æŒç»­æ—¶é—´:**
- `fastDuration: 0.15s` - å¿«é€ŸåŠ¨ç”»ï¼ˆ150msï¼‰
- `normalDuration: 0.25s` - æ­£å¸¸åŠ¨ç”»ï¼ˆ250msï¼‰
- `slowDuration: 0.35s` - æ…¢é€ŸåŠ¨ç”»ï¼ˆ350msï¼‰

**ç¼“åŠ¨å‡½æ•°:**
- `fast` - å¿«é€Ÿç¼“å‡ºåŠ¨ç”»ï¼ˆ150msï¼‰
- `normal` - æ­£å¸¸åŠ¨ç”»ï¼ˆ250msï¼‰
- `easeInOut` - ç¼“å…¥ç¼“å‡ºåŠ¨ç”»ï¼ˆ250msï¼‰
- `spring` - å¼¹ç°§åŠ¨ç”»ï¼ˆresponse: 0.3, damping: 0.7ï¼‰
- `gentle` - æŸ”å’Œç¼“å‡ºåŠ¨ç”»ï¼ˆ150msï¼‰

**ä½¿ç”¨åœºæ™¯:**
- æŒ‰é’®äº¤äº’
- çŠ¶æ€åˆ‡æ¢
- è§†å›¾è¿‡æ¸¡
- ç„¦ç‚¹å˜åŒ–

---

#### 4. DesignFonts - å­—ä½“ç³»ç»Ÿ

**å­—ä½“æ ·å¼:**
- `title` - æ ‡é¢˜ï¼ˆç²—ä½“ï¼‰
- `headline` - æ ‡é¢˜ï¼ˆåŠç²—ä½“ï¼‰
- `body` - æ­£æ–‡ï¼ˆå¸¸è§„ï¼‰
- `caption` - è¯´æ˜ï¼ˆå°å·ï¼‰
- `input` - è¾“å…¥å­—æ®µï¼ˆ14pt ç³»ç»Ÿå­—ä½“ï¼‰

**ä½¿ç”¨åœºæ™¯:**
- é¡µé¢æ ‡é¢˜
- åˆ†åŒºæ ‡é¢˜
- æ­£æ–‡å†…å®¹
- è¾…åŠ©è¯´æ˜
- è¡¨å•è¾“å…¥

---

### ViewModifiers.swift

**ä½œç”¨ï¼š** æä¾›å¯é‡ç”¨çš„è§†å›¾ä¿®é¥°å™¨ï¼Œå®ç°ä¸€è‡´çš„äº¤äº’æ•ˆæœã€‚

---

#### 1. EnhancedTextFieldStyle - å¢å¼ºæ–‡æœ¬æ¡†æ ·å¼

**åŠŸèƒ½:**
- ç„¦ç‚¹çŠ¶æ€å‘å…‰è¾¹æ¡†
- æ‚¬åœçŠ¶æ€è¾¹æ¡†
- ç¼©æ”¾åŠ¨ç”»
- å¹³æ»‘è¿‡æ¸¡

**çŠ¶æ€:**
- `@FocusState private var isFocused` - ç„¦ç‚¹çŠ¶æ€
- `@State private var isHovered` - æ‚¬åœçŠ¶æ€

**è§†è§‰æ•ˆæœ:**

**æ­£å¸¸çŠ¶æ€:**
- å†…è¾¹è·: 12pt
- èƒŒæ™¯: æµ…è‰²è¡¨é¢
- æ— è¾¹æ¡†
- æ— é˜´å½±

**æ‚¬åœçŠ¶æ€:**
- è¾¹æ¡†: ç°è‰² 1pt
- ç¼©æ”¾: 1.01
- åŠ¨ç”»: æŸ”å’Œç¼“å‡º

**ç„¦ç‚¹çŠ¶æ€:**
- è¾¹æ¡†: è“è‰² 2pt
- é˜´å½±: è“è‰²å‘å…‰ï¼ˆåŠå¾„ 4ptï¼‰
- åŠ¨ç”»: ç¼“å…¥ç¼“å‡º

**ä½¿ç”¨æ–¹æ³•:**
```swift
TextField("è¾“å…¥", text: $text)
    .enhancedTextFieldStyle()
```

---

#### 2. EnhancedButtonStyle - å¢å¼ºæŒ‰é’®æ ·å¼

**å‚æ•°:**
- `isPrimary: Bool` - æ˜¯å¦ä¸ºä¸»è¦æŒ‰é’®
- `isDisabled: Bool` - æ˜¯å¦ç¦ç”¨

**çŠ¶æ€:**
- `@State private var isHovered` - æ‚¬åœçŠ¶æ€
- `@State private var isPressed` - æŒ‰ä¸‹çŠ¶æ€

**è§†è§‰æ•ˆæœ:**

**ä¸»è¦æŒ‰é’®:**
- æ­£å¸¸: è“è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—
- æ‚¬åœ: è“è‰² 80% é€æ˜åº¦ï¼Œç¼©æ”¾ 1.02
- æŒ‰ä¸‹: è“è‰² 60% é€æ˜åº¦ï¼Œç¼©æ”¾ 0.95
- ç¦ç”¨: ç°è‰² 30% é€æ˜åº¦ï¼Œä¸é€æ˜åº¦ 0.5

**æ¬¡è¦æŒ‰é’®:**
- æ­£å¸¸: ç°è‰² 20% é€æ˜åº¦èƒŒæ™¯ï¼Œä¸»è¦æ–‡å­—è‰²
- æ‚¬åœ: ç°è‰² 30% é€æ˜åº¦ï¼Œç¼©æ”¾ 1.02
- æŒ‰ä¸‹: ç°è‰² 40% é€æ˜åº¦ï¼Œç¼©æ”¾ 0.95
- ç¦ç”¨: ç°è‰² 30% é€æ˜åº¦ï¼Œä¸é€æ˜åº¦ 0.5

**å†…è¾¹è·:**
- æ°´å¹³: 16pt
- å‚ç›´: 8pt

**åœ†è§’:**
- 8pt

**åŠ¨ç”»:**
- æ‚¬åœ: æŸ”å’Œç¼“å‡º
- æŒ‰ä¸‹: å¿«é€ŸåŠ¨ç”»

**ä½¿ç”¨æ–¹æ³•:**
```swift
Button("ä¿å­˜") { }
    .enhancedButtonStyle(isPrimary: true)

Button("å–æ¶ˆ") { }
    .enhancedButtonStyle(isPrimary: false)
```

---

#### 3. SmoothScrollStyle - å¹³æ»‘æ»šåŠ¨æ ·å¼

**åŠŸèƒ½:**
- éšè—é»˜è®¤æ»šåŠ¨æ¡
- æ˜¾ç¤ºè‡ªå®šä¹‰æ»šåŠ¨æ¡
- ç»†åœ†è§’æ ·å¼

**è§†è§‰æ•ˆæœ:**
- æ»šåŠ¨æ¡å®½åº¦: 4pt
- æ»šåŠ¨æ¡é¢œè‰²: è¾¹æ¡†ç°è‰²
- åœ†è§’: 2pt
- ä½ç½®: å³ä¾§ï¼Œè·ç¦»è¾¹ç¼˜ 2pt

**ä½¿ç”¨æ–¹æ³•:**
```swift
ScrollView {
    // å†…å®¹
}
.smoothScrollStyle()
```

---

#### View æ‰©å±•

**ä¾¿æ·æ–¹æ³•:**

```swift
extension View {
    func enhancedTextFieldStyle() -> some View
    func enhancedButtonStyle(isPrimary: Bool, isDisabled: Bool) -> some View
    func smoothScrollStyle() -> some View
}
```

**ä½œç”¨:**
- ç®€åŒ–ä¿®é¥°å™¨è°ƒç”¨
- æä¾›é“¾å¼è°ƒç”¨
- ç»Ÿä¸€ API é£æ ¼

---

## æ•°æ®æµä¸çŠ¶æ€ç®¡ç†

### æ¶æ„æ¨¡å¼

æœ¬åº”ç”¨é‡‡ç”¨ **MVVM (Model-View-ViewModel)** æ¶æ„æ¨¡å¼ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              View Layer                 â”‚
â”‚  (PetView, PreferencesView)            â”‚
â”‚  - ç”¨æˆ·ç•Œé¢                             â”‚
â”‚  - ç”¨æˆ·äº¤äº’                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ @ObservedObject
               â”‚ @Binding
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ViewModel Layer                â”‚
â”‚  (PetViewBackend, PreferencesViewBackend)â”‚
â”‚  - ä¸šåŠ¡é€»è¾‘                             â”‚
â”‚  - çŠ¶æ€ç®¡ç†                             â”‚
â”‚  - æ•°æ®è½¬æ¢                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ è°ƒç”¨
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Service Layer                  â”‚
â”‚  (APIManager)                           â”‚
â”‚  - ç½‘ç»œè¯·æ±‚                             â”‚
â”‚  - æ•°æ®å¤„ç†                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ è¿”å›æ•°æ®
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Model Layer                   â”‚
â”‚  (PetCharacter, PreferencesData)       â”‚
â”‚  - æ•°æ®æ¨¡å‹                             â”‚
â”‚  - ä¸šåŠ¡å®ä½“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### çŠ¶æ€ç®¡ç†æœºåˆ¶

#### 1. å“åº”å¼çŠ¶æ€ (@Published)

**PetViewBackend:**
```swift
@Published var currentCharacter: PetCharacter
@Published var currentGif: String
@Published var isReacting: Bool
@Published var userInput: String
@Published var isThinking: Bool
@Published var streamedResponse: String
```

**PreferencesViewBackend:**
```swift
@Published var selectedSection: PreferenceSection?
@Published var validationErrors: [String: String]
@Published var hasUnsavedChanges: Bool
@Published var customCharacters: [PetCharacter]
@Published var staticMessages: [String]
```

**å·¥ä½œåŸç†:**
- å±æ€§å€¼å˜åŒ–æ—¶è‡ªåŠ¨é€šçŸ¥è§†å›¾
- è§†å›¾è‡ªåŠ¨é‡æ–°æ¸²æŸ“
- å®ç°æ•°æ®é©±åŠ¨çš„ UI æ›´æ–°

---

#### 2. æŒä¹…åŒ–å­˜å‚¨ (@AppStorage)

**å­˜å‚¨çš„è®¾ç½®é¡¹:**
```swift
@AppStorage("apiKey") private var apiKey: String
@AppStorage("aiModel") private var aiModel: String
@AppStorage("systemPrompt") private var systemPrompt: String
@AppStorage("apiUrl") private var apiUrl: String
@AppStorage("provider") private var provider: String
@AppStorage("overlapRatio") private var overlapRatio: Double
```

**å·¥ä½œåŸç†:**
- è‡ªåŠ¨åŒæ­¥åˆ° UserDefaults
- åº”ç”¨é‡å¯åè‡ªåŠ¨æ¢å¤
- è·¨è§†å›¾å…±äº«æ•°æ®

**å­˜å‚¨ä½ç½®:**
```
~/Library/Preferences/[BundleID].plist
```

---

#### 3. ç„¦ç‚¹çŠ¶æ€ (@FocusState)

**PreferencesView:**
```swift
@FocusState private var focusedField: FocusableField?

enum FocusableField: Hashable {
    case systemPrompt
    case provider
    case model
    case apiUrl
    case apiKey
    case characterPicker
}
```

**ä½œç”¨:**
- ç®¡ç†è¾“å…¥æ¡†ç„¦ç‚¹
- æ§åˆ¶é”®ç›˜å¯¼èˆª
- ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

---

### æ•°æ®æµå‘

#### 1. ç”¨æˆ·è¾“å…¥æµ

```
ç”¨æˆ·è¾“å…¥æ–‡æœ¬
    â†“
PetView.userInput (@Binding)
    â†“
PetViewBackend.userInput (@Published)
    â†“
PetViewBackend.submitInput()
    â†“
æ£€æµ‹éŸ³ä¹å…³é”®è¯ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ playSongInAppleMusic()
    â””â”€ å¦ â†’ sendRequest()
              â†“
          APIManager.sendStreamRequest()
              â†“
          æµå¼æ¥æ”¶å“åº”
              â†“
          PetViewBackend.streamedResponse (@Published)
              â†“
          PetView è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º
```

---

#### 2. è®¾ç½®ä¿å­˜æµ

```
ç”¨æˆ·ä¿®æ”¹è®¾ç½®
    â†“
PreferencesView (@AppStorage è‡ªåŠ¨æ›´æ–°)
    â†“
PreferencesViewBackend.checkUnsavedChanges()
    â†“
æ˜¾ç¤ºæœªä¿å­˜æŒ‡ç¤ºå™¨
    â†“
ç”¨æˆ·ç‚¹å‡»ä¿å­˜
    â†“
PreferencesViewBackend.saveSettings()
    â†“
éªŒè¯æ‰€æœ‰å­—æ®µ
    â†“
ä¿å­˜é™æ€æç¤ºè¯åˆ° UserDefaults
    â†“
å‘é€ "SettingsChanged" é€šçŸ¥
    â†“
æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    â†“
å…³é—­çª—å£
```

---

#### 3. è§’è‰²åˆ‡æ¢æµ

```
ç”¨æˆ·é€‰æ‹©è§’è‰²
    â†“
PreferencesView.selectedIndex (@State)
    â†“
PreferencesViewBackend.switchCharacter()
    â†“
PetViewBackend.switchToCharacter()
    â†“
æ›´æ–° currentCharacter (@Published)
    â†“
æ›´æ–° currentGif (@Published)
    â†“
PetView è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º
```

---

#### 4. è‡ªåŠ¨è¡Œä¸ºæµ

```
åº”ç”¨å¯åŠ¨
    â†“
PetViewBackend.onAppear()
    â†“
startAutoActionLoop()
    â†“
scheduleNextAutoAction()
    â†“
å»¶è¿Ÿ 270-330 ç§’
    â†“
performAutoAction()
    â”œâ”€ playNextGif()
    â”‚   â†“
    â”‚   æ›´æ–° currentGif (@Published)
    â”‚   â†“
    â”‚   æ›´æ–° isReacting (@Published)
    â”‚
    â””â”€ é€‰æ‹©æ¶ˆæ¯
        â”œâ”€ ä¼˜å…ˆï¼šé™æ€æç¤ºè¯
        â””â”€ å¤‡é€‰ï¼šautoMessages
        â†“
        æ›´æ–° streamedResponse (@Published)
        â†“
        PetView è‡ªåŠ¨æ›´æ–°æ˜¾ç¤º
        â†“
        é€’å½’è°ƒåº¦ä¸‹ä¸€æ¬¡
```

---

### é€šçŸ¥æœºåˆ¶

#### NotificationCenter ä½¿ç”¨

**å‘é€é€šçŸ¥:**
```swift
NotificationCenter.default.post(
    name: NSNotification.Name("SettingsChanged"),
    object: nil
)
```

**ç›‘å¬é€šçŸ¥:**
```swift
NotificationCenter.default.addObserver(
    self,
    selector: #selector(onAppDidBecomeActive),
    name: NSApplication.didBecomeActiveNotification,
    object: nil
)
```

**åº”ç”¨åœºæ™¯:**
- åº”ç”¨æ¿€æ´»/å¤±æ´»
- è®¾ç½®æ›´æ”¹é€šçŸ¥
- è·¨ç»„ä»¶é€šä¿¡

---

### æ•°æ®æŒä¹…åŒ–

#### UserDefaults å­˜å‚¨

**å­˜å‚¨çš„æ•°æ®:**

1. **åº”ç”¨è®¾ç½®:**
   - `apiKey` - API å¯†é’¥
   - `aiModel` - AI æ¨¡å‹
   - `systemPrompt` - ç³»ç»Ÿæç¤ºè¯
   - `apiUrl` - API åœ°å€
   - `provider` - æœåŠ¡æä¾›å•†
   - `overlapRatio` - é‡å æ¯”ä¾‹

2. **è‡ªå®šä¹‰æ•°æ®:**
   - `customCharacters` - è‡ªå®šä¹‰è§’è‰²åˆ—è¡¨ï¼ˆJSONï¼‰
   - `staticMessages` - é™æ€æç¤ºè¯åˆ—è¡¨ï¼ˆJSONï¼‰

**è¯»å–ç¤ºä¾‹:**
```swift
if let data = UserDefaults.standard.data(forKey: "staticMessages"),
   let messages = try? JSONDecoder().decode([String].self, from: data) {
    staticMessages = messages
}
```

**ä¿å­˜ç¤ºä¾‹:**
```swift
if let data = try? JSONEncoder().encode(staticMessages) {
    UserDefaults.standard.set(data, forKey: "staticMessages")
}
```

---

#### æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨

**è‡ªå®šä¹‰è§’è‰² GIF æ–‡ä»¶:**

**å­˜å‚¨è·¯å¾„:**
```
~/Library/Application Support/{BundleID}/CustomAnimations/
```

**æ–‡ä»¶å‘½å:**
- ç«™ç«‹ GIF: `{è§’è‰²å}_ç«™ç«‹.gif`
- åŠ¨ä½œ GIF: `{è§’è‰²å}_åŠ¨ä½œ.gif`

**å­˜å‚¨æµç¨‹:**
1. ç”¨æˆ·é€‰æ‹© GIF æ–‡ä»¶
2. å¤åˆ¶åˆ°åº”ç”¨æ”¯æŒç›®å½•
3. ä¿å­˜å®Œæ•´è·¯å¾„åˆ° PetCharacter
4. JSON ç¼–ç ä¿å­˜åˆ° UserDefaults

---

### çŠ¶æ€åŒæ­¥

#### ä¸´æ—¶å€¼æœºåˆ¶

**ç›®çš„:**
- æ”¯æŒå–æ¶ˆæ“ä½œ
- æ£€æµ‹æœªä¿å­˜æ›´æ”¹
- æ¢å¤åŸå§‹å€¼

**å®ç°:**
```swift
// ä¿å­˜ä¸´æ—¶å€¼
func loadTemporaryValues(...) {
    tempApiKey = apiKey
    tempAiModel = aiModel
    // ...
}

// æ£€æŸ¥æ›´æ”¹
func checkUnsavedChanges(...) {
    hasUnsavedChanges = apiKey != tempApiKey ||
                       aiModel != tempAiModel ||
                       // ...
}

// å–æ¶ˆæ›´æ”¹
func cancelChanges() {
    apiKey = tempApiKey
    aiModel = tempAiModel
    // ...
}
```

---

### å¹¶å‘å¤„ç†

#### ä¸»çº¿ç¨‹æ›´æ–°

**åŸåˆ™:**
- UI æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹
- ä½¿ç”¨ `DispatchQueue.main.async`

**ç¤ºä¾‹:**
```swift
apiManager.sendStreamRequest(userInput: userInput) { newContent in
    DispatchQueue.main.async {
        self.streamedResponse += newContent
    }
} onComplete: {
    DispatchQueue.main.async {
        self.isThinking = false
    }
}
```

---

#### å®šæ—¶å™¨ç®¡ç†

**ä½¿ç”¨ Combine:**
```swift
periodicAutoActionTimer = Just(())
    .delay(for: .seconds(delay), scheduler: DispatchQueue.main)
    .sink { [weak self] _ in
        self?.performAutoAction()
        self?.scheduleNextAutoAction()
    }
```

**ä¼˜ç‚¹:**
- è‡ªåŠ¨å†…å­˜ç®¡ç†
- æ˜“äºå–æ¶ˆ
- æ”¯æŒé“¾å¼æ“ä½œ

---

## åŠŸèƒ½ç‰¹æ€§

### 1. æ¡Œé¢å® ç‰©æ˜¾ç¤º

#### æ‚¬æµ®çª—å£
- **é€æ˜èƒŒæ™¯**: çª—å£èƒŒæ™¯å®Œå…¨é€æ˜ï¼Œåªæ˜¾ç¤º GIF å†…å®¹
- **æ— è¾¹æ¡†**: éšè—æ ‡é¢˜æ å’Œè¾¹æ¡†
- **å§‹ç»ˆåœ¨æœ€å‰**: çª—å£çº§åˆ«è®¾ç½®ä¸º `.floating`
- **å¤šç©ºé—´æ”¯æŒ**: å¯åœ¨æ‰€æœ‰è™šæ‹Ÿæ¡Œé¢æ˜¾ç¤º
- **å¯æ‹–åŠ¨**: é€šè¿‡æ‹–åŠ¨ GIF å›¾åƒç§»åŠ¨çª—å£

#### GIF åŠ¨ç”»
- **åŒçŠ¶æ€åŠ¨ç”»**:
  - ç«™ç«‹çŠ¶æ€: å¾ªç¯æ’­æ”¾ç«™ç«‹ GIF
  - ç‚¹å‡»çŠ¶æ€: æ’­æ”¾ç‚¹å‡»åŠ¨ä½œ GIF
- **è‡ªåŠ¨æ—¶é•¿è®¡ç®—**: è¯»å– GIF å¸§å»¶è¿Ÿï¼Œç²¾ç¡®è®¡ç®—æ’­æ”¾æ—¶é•¿
- **å¹³æ»‘åˆ‡æ¢**: åŠ¨ç”»ç»“æŸåè‡ªåŠ¨åˆ‡æ¢å›ç«™ç«‹çŠ¶æ€

#### äº¤äº’æ–¹å¼
- **ç‚¹å‡»è§¦å‘**: ç‚¹å‡»å® ç‰©æ’­æ”¾åŠ¨ä½œåŠ¨ç”»
- **æ‹–åŠ¨ç§»åŠ¨**: æ‹–åŠ¨å® ç‰©ç§»åŠ¨çª—å£ä½ç½®
- **é˜²é‡å¤è§¦å‘**: åŠ¨ç”»æ’­æ”¾æœŸé—´ç¦æ­¢å†æ¬¡è§¦å‘

---

### 2. AI å¯¹è¯åŠŸèƒ½

#### å¯¹è¯ç•Œé¢
- **è¾“å…¥æ¡†**: é¡¶éƒ¨æ–‡æœ¬è¾“å…¥æ¡†ï¼Œæ”¯æŒå›è½¦æäº¤
- **è¾“å‡ºåŒº**: ä¸­é—´æ»šåŠ¨åŒºåŸŸæ˜¾ç¤º AI å›å¤
- **è‡ªåŠ¨æ»šåŠ¨**: æ–°å†…å®¹å‡ºç°æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
- **æ€è€ƒçŠ¶æ€**: æ˜¾ç¤º"æ€è€ƒä¸­..."æç¤º

#### æµå¼å“åº”
- **å®æ—¶æ˜¾ç¤º**: AI å›å¤é€å­—æ˜¾ç¤ºï¼Œæ— éœ€ç­‰å¾…å®Œæ•´å“åº”
- **ç´¯ç§¯æ–‡æœ¬**: æ–°å†…å®¹è¿½åŠ åˆ°ç°æœ‰æ–‡æœ¬
- **å¹³æ»‘ä½“éªŒ**: ç±»ä¼¼æ‰“å­—æœºæ•ˆæœ

#### å¤šå¹³å°æ”¯æŒ
- **æ™ºè°±æ¸…è¨€**: æ”¯æŒ GLM ç³»åˆ—æ¨¡å‹
- **é€šä¹‰åƒé—®**: æ”¯æŒ Qwen ç³»åˆ—æ¨¡å‹
- **è‡ªåŠ¨é€‚é…**: æ ¹æ®é€‰æ‹©çš„å¹³å°è‡ªåŠ¨è°ƒæ•´è¯·æ±‚æ ¼å¼

---

### 3. è‡ªåŠ¨äº’åŠ¨ç³»ç»Ÿ

#### å®šæ—¶è§¦å‘
- **éšæœºé—´éš”**: 4.5-5.5 åˆ†é’Ÿéšæœºè§¦å‘
- **åå°è¿è¡Œ**: åº”ç”¨å¤±å»ç„¦ç‚¹æ—¶ç»§ç»­è¿è¡Œ
- **è‡ªåŠ¨å¾ªç¯**: æ‰§è¡Œåè‡ªåŠ¨è°ƒåº¦ä¸‹ä¸€æ¬¡

#### æ¶ˆæ¯æ¥æº
- **ä¼˜å…ˆçº§**:
  1. ç”¨æˆ·è‡ªå®šä¹‰çš„é™æ€æç¤ºè¯
  2. è§’è‰²é»˜è®¤çš„ autoMessages
- **éšæœºé€‰æ‹©**: ä»æ¶ˆæ¯åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ä¸€æ¡

#### åŠ¨ç”»é…åˆ
- **åŒæ­¥æ’­æ”¾**: æ˜¾ç¤ºæ¶ˆæ¯æ—¶æ’­æ”¾ç‚¹å‡»åŠ¨ç”»
- **æ—¶é•¿åŒ¹é…**: åŠ¨ç”»æ—¶é•¿ä¸ GIF å®é™…æ—¶é•¿ä¸€è‡´

---

### 4. è§’è‰²ç³»ç»Ÿ

#### å†…ç½®è§’è‰²
1. **å¸ƒå¶ç†ŠÂ·è§…è¯­**
   - å¯çˆ±å‚²å¨‡é£æ ¼
   - 7 æ¡è‡ªåŠ¨æ¶ˆæ¯
   - ç«™ç«‹å’ŒåŠ¨ä½œä¸¤ä¸ª GIF

2. **å¤æé›…**
   - çŒ«å¨˜é£æ ¼
   - 2 æ¡è‡ªåŠ¨æ¶ˆæ¯
   - å•ä¸€ GIF

#### è‡ªå®šä¹‰è§’è‰²
- **å¯¼å…¥åŠŸèƒ½**: æ”¯æŒå¯¼å…¥è‡ªå®šä¹‰ GIF
- **æ•°é‡é™åˆ¶**: æœ€å¤š 3 ä¸ªè‡ªå®šä¹‰è§’è‰²
- **åŒ GIF æ”¯æŒ**: å¯é€‰æ‹©ç«™ç«‹å’ŒåŠ¨ä½œ GIF
- **å• GIF æ¨¡å¼**: åªé€‰æ‹©ç«™ç«‹ GIFï¼ŒåŠ¨ä½œä½¿ç”¨ç›¸åŒ GIF
- **æ–‡ä»¶ç®¡ç†**: è‡ªåŠ¨å¤åˆ¶åˆ°åº”ç”¨æ”¯æŒç›®å½•
- **åˆ é™¤åŠŸèƒ½**: åˆ é™¤è§’è‰²æ—¶åŒæ—¶åˆ é™¤ GIF æ–‡ä»¶

#### è§’è‰²åˆ‡æ¢
- **å³æ—¶åˆ‡æ¢**: åˆ‡æ¢åç«‹å³æ˜¾ç¤ºæ–°è§’è‰²
- **çŠ¶æ€ä¿æŒ**: ä¿æŒå½“å‰å¯¹è¯å†…å®¹
- **åŠ¨ç”»é‡ç½®**: é‡ç½®ä¸ºç«™ç«‹çŠ¶æ€

---

### 5. åå¥½è®¾ç½®

#### é£æ ¼è®¾ç½®
- **ç³»ç»Ÿæç¤ºè¯**:
  - å¤šè¡Œç¼–è¾‘å™¨
  - å­—ç¬¦è®¡æ•°ï¼ˆé™åˆ¶ 500ï¼‰
  - è¶…é•¿è­¦å‘Š
  - é‡ç½®ä¸ºé»˜è®¤
- **é™æ€æç¤ºè¯**:
  - åˆ—è¡¨ç®¡ç†
  - æ·»åŠ /ç¼–è¾‘/åˆ é™¤
  - æ•°é‡ç»Ÿè®¡
  - æ»šåŠ¨æ˜¾ç¤º

#### æ¨¡å‹è®¾ç½®
- **æä¾›å•†é€‰æ‹©**: æ™ºè°±æ¸…è¨€ / é€šä¹‰åƒé—®
- **æ¨¡å‹é…ç½®**: è¾“å…¥æ¨¡å‹åç§°
- **API åœ°å€**: é…ç½® API ç«¯ç‚¹
- **API Key**: è¾“å…¥è®¿é—®å¯†é’¥
- **å®æ—¶éªŒè¯**: è¾“å…¥æ—¶å³æ—¶éªŒè¯
- **é”™è¯¯æç¤º**: æ˜¾ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯
- **æˆåŠŸåé¦ˆ**: æ˜¾ç¤ºéªŒè¯æˆåŠŸçŠ¶æ€

#### å¸ƒå±€è®¾ç½®
- **å¯è§†åŒ–é¢„è§ˆ**: å®æ—¶é¢„è§ˆé‡å æ•ˆæœ
- **æ»‘å—æ§åˆ¶**: 0-100% ç²¾ç¡®è°ƒæ•´
- **ç™¾åˆ†æ¯”æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºå½“å‰å€¼
- **ä¸‰å±‚é¢„è§ˆ**:
  - è¾“å…¥æ¡†å±‚
  - å¯¹è¯è¾“å‡ºå±‚
  - å® ç‰©å›¾åƒå±‚

#### è§’è‰²ç»‘å®š
- **è§’è‰²é€‰æ‹©å™¨**: ä¸‹æ‹‰èœå•é€‰æ‹©è§’è‰²
- **è§’è‰²ç»Ÿè®¡**: æ˜¾ç¤ºå†…ç½®å’Œè‡ªå®šä¹‰æ•°é‡
- **å¯¼å…¥å‘å¯¼**:
  1. é€‰æ‹©ç«™ç«‹ GIF
  2. è¾“å…¥è§’è‰²åç§°
  3. é€‰æ‹©åŠ¨ä½œ GIFï¼ˆå¯é€‰ï¼‰
- **è§’è‰²åˆ—è¡¨**: æ˜¾ç¤ºæ‰€æœ‰è‡ªå®šä¹‰è§’è‰²
- **åˆ é™¤åŠŸèƒ½**: ä¸€é”®åˆ é™¤è‡ªå®šä¹‰è§’è‰²

#### å…³äºé¡µé¢
- **åº”ç”¨ä¿¡æ¯**: æ˜¾ç¤ºåº”ç”¨åç§°å’Œç‰ˆæœ¬
- **å½“å‰è§’è‰²**: æ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨çš„è§’è‰²
- **åº”ç”¨æè¿°**: ç®€çŸ­ä»‹ç»

---

### 6. éŸ³ä¹æ’­æ”¾é›†æˆ

#### å…³é”®è¯è¯†åˆ«
- **è§¦å‘è¯**: "æˆ‘æƒ³å¬"ã€"æ’­æ”¾"ã€"æ¥ä¸€é¦–"ã€"æ¥ç‚¹"ã€"å¸®æˆ‘æ”¾"
- **æ­Œåæå–**: è‡ªåŠ¨æå–æ­Œæ›²åç§°
- **åç¼€å¤„ç†**: ç§»é™¤"çš„æ­Œ"ç­‰å°¾ç¼€

#### æ’­æ”¾æ–¹å¼
- **ä¼˜å…ˆåº”ç”¨**: å°è¯•æ‰“å¼€ Apple Music åº”ç”¨
- **å¤‡é€‰ç½‘é¡µ**: åº”ç”¨æ‰“å¼€å¤±è´¥æ—¶æ‰“å¼€ç½‘é¡µç‰ˆ
- **æœç´¢é¡µé¢**: æ‰“å¼€æ­Œæ›²æœç´¢ç»“æœé¡µ

#### ç”¨æˆ·åé¦ˆ
- **æˆåŠŸæç¤º**: "å·²ç»å¸®æŒ‡æŒ¥å®˜æ‰“å¼€ã€Šæ­Œåã€‹çš„æœç´¢å•¦ï½"
- **å¤±è´¥æç¤º**: "å‘œï½å¥½åƒæ‰“ä¸å¼€éŸ³ä¹åº”ç”¨å‘¢"
- **è§’è‰²é£æ ¼**: ä½¿ç”¨è§’è‰²ç‰¹æœ‰çš„è¯­æ°”

---

### 7. æ•°æ®éªŒè¯

#### å®æ—¶éªŒè¯
- **å³æ—¶åé¦ˆ**: è¾“å…¥æ—¶ç«‹å³éªŒè¯
- **é”™è¯¯æç¤º**: æ˜¾ç¤ºå…·ä½“é”™è¯¯åŸå› 
- **æˆåŠŸæŒ‡ç¤º**: æ˜¾ç¤ºéªŒè¯é€šè¿‡çŠ¶æ€
- **è§†è§‰åé¦ˆ**: è¾¹æ¡†é¢œè‰²å˜åŒ–

#### éªŒè¯è§„åˆ™
- **API Key**:
  - ä¸èƒ½ä¸ºç©º
  - ä¸èƒ½æ˜¯é»˜è®¤å€¼
- **API URL**:
  - ä¸èƒ½ä¸ºç©º
  - å¿…é¡»æ˜¯æœ‰æ•ˆ URL
  - å¿…é¡»ä½¿ç”¨ HTTPS
- **æ¨¡å‹åç§°**:
  - ä¸èƒ½ä¸ºç©º
  - åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€è¿å­—ç¬¦

#### ä¿å­˜æ§åˆ¶
- **ç¦ç”¨ä¿å­˜**: éªŒè¯å¤±è´¥æ—¶ç¦ç”¨ä¿å­˜æŒ‰é’®
- **é”™è¯¯æ±‡æ€»**: ä¿å­˜æ—¶æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯
- **æˆåŠŸæç¤º**: ä¿å­˜æˆåŠŸæ˜¾ç¤ºæ¨ªå¹…æ¶ˆæ¯

---

### 8. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### è§†è§‰åé¦ˆ
- **æ‚¬åœæ•ˆæœ**: æŒ‰é’®å’Œè¾“å…¥æ¡†æ‚¬åœæ—¶é«˜äº®
- **æŒ‰ä¸‹æ•ˆæœ**: æŒ‰é’®æŒ‰ä¸‹æ—¶ç¼©æ”¾
- **ç„¦ç‚¹æŒ‡ç¤º**: è¾“å…¥æ¡†ç„¦ç‚¹æ—¶å‘å…‰è¾¹æ¡†
- **åŠ è½½çŠ¶æ€**: æ˜¾ç¤ºæ€è€ƒä¸­åŠ¨ç”»

#### åŠ¨ç”»æ•ˆæœ
- **å¹³æ»‘è¿‡æ¸¡**: æ‰€æœ‰çŠ¶æ€å˜åŒ–ä½¿ç”¨åŠ¨ç”»
- **å¼¹ç°§åŠ¨ç”»**: æˆåŠŸæ¶ˆæ¯ä½¿ç”¨å¼¹ç°§æ•ˆæœ
- **æ·¡å…¥æ·¡å‡º**: æç¤ºæ¶ˆæ¯æ·¡å…¥æ·¡å‡º
- **ç¼©æ”¾åŠ¨ç”»**: æŒ‰é’®äº¤äº’ä½¿ç”¨ç¼©æ”¾

#### æœªä¿å­˜æç¤º
- **è„‰åŠ¨æŒ‡ç¤ºå™¨**: æ©™è‰²åœ†ç‚¹è„‰åŠ¨åŠ¨ç”»
- **æ–‡å­—æç¤º**: "æœªä¿å­˜çš„æ›´æ”¹"
- **å®æ—¶æ£€æµ‹**: ä»»ä½•ä¿®æ”¹ç«‹å³æ˜¾ç¤º
- **å–æ¶ˆæ¢å¤**: å–æ¶ˆæ—¶æ¢å¤åŸå§‹å€¼

#### æˆåŠŸåé¦ˆ
- **æ¨ªå¹…æ¶ˆæ¯**: ä»é¡¶éƒ¨æ»‘å…¥
- **ç»¿è‰²èƒŒæ™¯**: æˆåŠŸçŠ¶æ€é¢œè‰²
- **å¯¹å‹¾å›¾æ ‡**: è§†è§‰ç¡®è®¤
- **è‡ªåŠ¨æ¶ˆå¤±**: 2 ç§’åè‡ªåŠ¨éšè—
- **è‡ªåŠ¨å…³é—­**: æ¶ˆå¤±åå…³é—­çª—å£

#### é”™è¯¯å¤„ç†
- **å‹å¥½æç¤º**: ä½¿ç”¨æ˜“æ‡‚çš„é”™è¯¯æ¶ˆæ¯
- **å…·ä½“åŸå› **: è¯´æ˜é”™è¯¯çš„å…·ä½“åŸå› 
- **è§£å†³å»ºè®®**: æç¤ºå¦‚ä½•ä¿®æ­£é”™è¯¯
- **è­¦å‘Šå¯¹è¯æ¡†**: ä¸¥é‡é”™è¯¯æ˜¾ç¤ºå¯¹è¯æ¡†

---

### 9. è¾…åŠ©åŠŸèƒ½æ”¯æŒ

#### æ— éšœç¢æ ‡ç­¾
- **accessibilityLabel**: ä¸ºæ‰€æœ‰äº¤äº’å…ƒç´ æ·»åŠ æ ‡ç­¾
- **accessibilityHint**: æä¾›æ“ä½œæç¤º
- **accessibilityValue**: æ˜¾ç¤ºå½“å‰å€¼

#### é”®ç›˜å¯¼èˆª
- **Tab é”®åˆ‡æ¢**: æ”¯æŒé”®ç›˜åœ¨å­—æ®µé—´åˆ‡æ¢
- **å›è½¦æäº¤**: è¾“å…¥æ¡†æ”¯æŒå›è½¦æäº¤
- **å¿«æ·é”®**: Cmd+, æ‰“å¼€åå¥½è®¾ç½®

#### è§†è§‰è¾…åŠ©
- **é«˜å¯¹æ¯”åº¦**: æ¸…æ™°çš„é¢œè‰²å¯¹æ¯”
- **å¤§å­—ä½“æ”¯æŒ**: ä½¿ç”¨ç³»ç»Ÿå­—ä½“å¤§å°
- **æ¸…æ™°å›¾æ ‡**: ä½¿ç”¨ SF Symbols å›¾æ ‡

---

### 10. æ€§èƒ½ä¼˜åŒ–

#### å†…å­˜ç®¡ç†
- **å¼±å¼•ç”¨**: é—­åŒ…ä¸­ä½¿ç”¨ `[weak self]`
- **åŠæ—¶é‡Šæ”¾**: è§†å›¾æ¶ˆå¤±æ—¶å–æ¶ˆå®šæ—¶å™¨
- **è§‚å¯Ÿè€…æ¸…ç†**: deinit æ—¶ç§»é™¤é€šçŸ¥è§‚å¯Ÿè€…

#### èµ„æºåŠ è½½
- **æŒ‰éœ€åŠ è½½**: GIF æ–‡ä»¶æŒ‰éœ€åŠ è½½
- **è·¯å¾„ç¼“å­˜**: ç¼“å­˜ GIF æ–‡ä»¶è·¯å¾„
- **Bundle ä¼˜åŒ–**: ä¼˜å…ˆä» Bundle åŠ è½½å†…ç½®èµ„æº

#### ç½‘ç»œä¼˜åŒ–
- **æµå¼ä¼ è¾“**: ä½¿ç”¨æµå¼ API å‡å°‘ç­‰å¾…
- **é”™è¯¯é‡è¯•**: ç½‘ç»œé”™è¯¯æ—¶å‹å¥½æç¤º
- **è¶…æ—¶å¤„ç†**: é¿å…é•¿æ—¶é—´ç­‰å¾…

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. GIF åŠ¨ç”»å¤„ç†

#### åŠ è½½æœºåˆ¶

**å†…ç½®è§’è‰² GIF:**
```swift
// ä» Bundle åŠ è½½
Bundle.main.url(forResource: "å¸ƒå¶ç†Šç«™ç«‹é€æ˜", withExtension: "gif")
```

**è‡ªå®šä¹‰è§’è‰² GIF:**
```swift
// ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½
URL(fileURLWithPath: "/path/to/custom.gif")
```

**æŸ¥æ‰¾ç­–ç•¥:**
1. æ£€æŸ¥è·¯å¾„æ˜¯å¦ä»¥ `/` å¼€å¤´
2. æ˜¯ â†’ æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
3. å¦ â†’ Bundle èµ„æº
   - ç›´æ¥æŸ¥æ‰¾
   - å»æ‰æ‰©å±•åæŸ¥æ‰¾
   - åœ¨å­ç›®å½•æŸ¥æ‰¾

---

#### æ—¶é•¿è®¡ç®—

**æŠ€æœ¯æ ˆ:**
- `CGImageSource` - å›¾åƒæº
- `CGImageSourceGetCount` - è·å–å¸§æ•°
- `CGImageSourceCopyPropertiesAtIndex` - è·å–å¸§å±æ€§

**å®ç°æ­¥éª¤:**
1. åˆ›å»ºå›¾åƒæº
2. è·å–æ€»å¸§æ•°
3. éå†æ¯ä¸€å¸§
4. è¯»å–å¸§å»¶è¿Ÿæ—¶é—´
5. ç´¯åŠ æ€»æ—¶é•¿

**å»¶è¿Ÿæ—¶é—´è¯»å–:**
```swift
// ä¼˜å…ˆä½¿ç”¨æœªé™åˆ¶çš„å»¶è¿Ÿæ—¶é—´
if let unclampedDelay = gifInfo[kCGImagePropertyGIFUnclampedDelayTime] {
    frameDuration = unclampedDelay
}
// å¤‡é€‰æ ‡å‡†å»¶è¿Ÿæ—¶é—´
else if let delay = gifInfo[kCGImagePropertyGIFDelayTime] {
    frameDuration = delay
}
// é»˜è®¤ 0.1 ç§’
else {
    frameDuration = 0.1
}
```

**å®¹é”™å¤„ç†:**
- æ— æ³•è¯»å– â†’ è¿”å›é»˜è®¤ 2.0 ç§’
- æ—¶é•¿è¿‡çŸ­ â†’ è¿”å›é»˜è®¤ 2.0 ç§’
- è°ƒè¯•æ¨¡å¼ â†’ æ‰“å°è¯¦ç»†ä¿¡æ¯

---

### 2. çª—å£ç®¡ç†

#### é€æ˜æ‚¬æµ®çª—å£

**å…³é”®å±æ€§:**
```swift
window.titleVisibility = .hidden              // éšè—æ ‡é¢˜
window.titlebarAppearsTransparent = true      // é€æ˜æ ‡é¢˜æ 
window.isOpaque = false                       // éä¸é€æ˜
window.backgroundColor = .clear               // é€æ˜èƒŒæ™¯
window.hasShadow = false                      // æ— é˜´å½±
window.level = .floating                      // æ‚¬æµ®çº§åˆ«
window.collectionBehavior = [
    .canJoinAllSpaces,                        // æ‰€æœ‰ç©ºé—´
    .fullScreenAuxiliary                      // å…¨å±è¾…åŠ©
]
window.isMovableByWindowBackground = true     // èƒŒæ™¯å¯æ‹–åŠ¨
```

**ç”Ÿå‘½å‘¨æœŸç®¡ç†:**
- `applicationDidFinishLaunching` - åº”ç”¨å¯åŠ¨æ—¶é…ç½®
- `applicationDidBecomeActive` - åº”ç”¨æ¿€æ´»æ—¶é‡æ–°é…ç½®
- ç¡®ä¿çª—å£å§‹ç»ˆä¿æŒæ­£ç¡®çŠ¶æ€

---

#### çª—å£æ‹–åŠ¨

**å®ç°æ–¹å¼:**
```swift
.gesture(
    DragGesture()
        .onChanged { value in
            isDragging = true
            moveWindow(by: value.translation)
        }
        .onEnded { _ in
            isDragging = false
        }
)
```

**ç§»åŠ¨é€»è¾‘:**
```swift
func moveWindow(by translation: CGSize) {
    guard let window = NSApplication.shared.windows.first else { return }
    let currentOrigin = window.frame.origin
    let newOrigin = CGPoint(
        x: currentOrigin.x + translation.width,
        y: currentOrigin.y - translation.height  // macOS åæ ‡ç³» Y è½´åå‘
    )
    window.setFrameOrigin(newOrigin)
}
```

**æ³¨æ„äº‹é¡¹:**
- macOS åæ ‡ç³»åŸç‚¹åœ¨å·¦ä¸‹è§’
- Y è½´å‘ä¸Šä¸ºæ­£æ–¹å‘
- æ‹–åŠ¨æ—¶éœ€è¦åè½¬ Y è½´

---

### 3. ç½‘ç»œé€šä¿¡

#### HTTP æµå¼è¯·æ±‚

**URLSession é…ç½®:**
```swift
let task = URLSession.shared.dataTask(with: request) { data, response, error in
    // å¤„ç†å“åº”
}
task.resume()
```

**æµå¼æ•°æ®å¤„ç†:**
```swift
guard let data = data,
      let text = String(data: data, encoding: .utf8) else { return }

let lines = text.components(separatedBy: "\n")
for line in lines {
    // å¤„ç†æ¯ä¸€è¡Œ
}
```

**SSE (Server-Sent Events) æ ¼å¼:**
```
data: {"choices":[{"delta":{"content":"æ–‡æœ¬"}}]}
data: {"choices":[{"delta":{"content":"æ›´å¤š"}}]}
data: [DONE]
```

**è§£ææµç¨‹:**
1. æŒ‰è¡Œåˆ†å‰²æ•°æ®
2. è¿‡æ»¤ `data:` å‰ç¼€
3. è·³è¿‡ `[DONE]` æ ‡è®°
4. JSON è§£æ
5. æå–å†…å®¹å­—æ®µ
6. è°ƒç”¨å›è°ƒå‡½æ•°

---

#### é”™è¯¯å¤„ç†

**ç½‘ç»œé”™è¯¯:**
```swift
if let error = error {
    print("ç½‘ç»œé”™è¯¯: \(error.localizedDescription)")
    return
}
```

**JSON è§£æé”™è¯¯:**
```swift
guard let json = try? JSONSerialization.jsonObject(with: jsonData) else {
    continue  // è·³è¿‡æ— æ•ˆè¡Œ
}
```

**ç©ºå†…å®¹å¤„ç†:**
```swift
guard !content.isEmpty else {
    continue  // è·³è¿‡ç©ºå†…å®¹
}
```

---

### 4. æ•°æ®æŒä¹…åŒ–

#### UserDefaults å­˜å‚¨

**ç®€å•ç±»å‹:**
```swift
// ä¿å­˜
UserDefaults.standard.set(value, forKey: "key")

// è¯»å–
let value = UserDefaults.standard.string(forKey: "key")
```

**å¤æ‚ç±»å‹ (JSON):**
```swift
// ä¿å­˜
if let data = try? JSONEncoder().encode(object) {
    UserDefaults.standard.set(data, forKey: "key")
}

// è¯»å–
if let data = UserDefaults.standard.data(forKey: "key"),
   let object = try? JSONDecoder().decode(Type.self, from: data) {
    // ä½¿ç”¨å¯¹è±¡
}
```

**@AppStorage åŒ…è£…å™¨:**
```swift
@AppStorage("apiKey") private var apiKey = "é»˜è®¤å€¼"
```

**ä¼˜ç‚¹:**
- è‡ªåŠ¨åŒæ­¥
- ç±»å‹å®‰å…¨
- ç®€åŒ–ä»£ç 

---

#### æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨

**è·å–åº”ç”¨æ”¯æŒç›®å½•:**
```swift
let fileManager = FileManager.default
let appSupportURL = fileManager.urls(
    for: .applicationSupportDirectory,
    in: .userDomainMask
).first

let appDirectory = appSupportURL.appendingPathComponent(
    Bundle.main.bundleIdentifier ?? "PetApp"
)
```

**åˆ›å»ºç›®å½•:**
```swift
try fileManager.createDirectory(
    at: directory,
    withIntermediateDirectories: true
)
```

**å¤åˆ¶æ–‡ä»¶:**
```swift
try fileManager.copyItem(at: sourceURL, to: destURL)
```

**åˆ é™¤æ–‡ä»¶:**
```swift
try fileManager.removeItem(at: fileURL)
```

**é”™è¯¯å¤„ç†:**
```swift
do {
    try fileManager.copyItem(at: source, to: dest)
} catch {
    print("æ–‡ä»¶æ“ä½œå¤±è´¥: \(error.localizedDescription)")
}
```

---

### 5. å®šæ—¶å™¨å®ç°

#### Combine å®šæ—¶å™¨

**åˆ›å»ºå®šæ—¶å™¨:**
```swift
periodicAutoActionTimer = Just(())
    .delay(for: .seconds(delay), scheduler: DispatchQueue.main)
    .sink { [weak self] _ in
        self?.performAutoAction()
        self?.scheduleNextAutoAction()
    }
```

**ä¼˜ç‚¹:**
- è‡ªåŠ¨å†…å­˜ç®¡ç†
- æ˜“äºå–æ¶ˆ
- æ”¯æŒé“¾å¼æ“ä½œ
- ç±»å‹å®‰å…¨

**å–æ¶ˆå®šæ—¶å™¨:**
```swift
periodicAutoActionTimer?.cancel()
periodicAutoActionTimer = nil
```

**å†…å­˜ç®¡ç†:**
- ä½¿ç”¨ `[weak self]` é¿å…å¾ªç¯å¼•ç”¨
- è§†å›¾æ¶ˆå¤±æ—¶å–æ¶ˆå®šæ—¶å™¨
- deinit æ—¶æ¸…ç†èµ„æº

---

### 6. é€šçŸ¥ç³»ç»Ÿ

#### ç³»ç»Ÿé€šçŸ¥

**æ³¨å†Œè§‚å¯Ÿè€…:**
```swift
NotificationCenter.default.addObserver(
    self,
    selector: #selector(onAppDidBecomeActive),
    name: NSApplication.didBecomeActiveNotification,
    object: nil
)
```

**ç§»é™¤è§‚å¯Ÿè€…:**
```swift
NotificationCenter.default.removeObserver(self)
```

**å¤„ç†é€šçŸ¥:**
```swift
@objc private func onAppDidBecomeActive() {
    // å¤„ç†åº”ç”¨æ¿€æ´»
}
```

---

#### è‡ªå®šä¹‰é€šçŸ¥

**å‘é€é€šçŸ¥:**
```swift
NotificationCenter.default.post(
    name: NSNotification.Name("SettingsChanged"),
    object: nil,
    userInfo: ["key": "value"]
)
```

**ç›‘å¬é€šçŸ¥:**
```swift
NotificationCenter.default.addObserver(
    forName: NSNotification.Name("SettingsChanged"),
    object: nil,
    queue: .main
) { notification in
    // å¤„ç†é€šçŸ¥
}
```

---

### 7. å¹¶å‘ä¸çº¿ç¨‹

#### ä¸»çº¿ç¨‹æ›´æ–°

**åŸåˆ™:**
- æ‰€æœ‰ UI æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹
- ä½¿ç”¨ `DispatchQueue.main.async`

**ç¤ºä¾‹:**
```swift
URLSession.shared.dataTask(with: request) { data, response, error in
    // åå°çº¿ç¨‹
    let result = processData(data)
    
    DispatchQueue.main.async {
        // ä¸»çº¿ç¨‹æ›´æ–° UI
        self.updateUI(with: result)
    }
}.resume()
```

---

#### å»¶è¿Ÿæ‰§è¡Œ

**å»¶è¿Ÿæ›´æ–°:**
```swift
DispatchQueue.main.asyncAfter(deadline: .now() + 2.0) {
    // 2 ç§’åæ‰§è¡Œ
    self.hideSuccessMessage()
}
```

**ç”¨é€”:**
- è‡ªåŠ¨éšè—æç¤º
- å»¶è¿Ÿå…³é—­çª—å£
- åŠ¨ç”»åºåˆ—

---

### 8. å†…å­˜ç®¡ç†

#### å¼±å¼•ç”¨

**é—­åŒ…ä¸­ä½¿ç”¨:**
```swift
.sink { [weak self] _ in
    guard let self = self else { return }
    self.performAction()
}
```

**é¿å…å¾ªç¯å¼•ç”¨:**
- å®šæ—¶å™¨é—­åŒ…
- ç½‘ç»œå›è°ƒ
- é€šçŸ¥å¤„ç†

---

#### èµ„æºæ¸…ç†

**deinit æ–¹æ³•:**
```swift
deinit {
    NotificationCenter.default.removeObserver(self)
    cancelAutoActionLoop()
}
```

**è§†å›¾ç”Ÿå‘½å‘¨æœŸ:**
```swift
.onDisappear {
    cancelAutoActionLoop()
    streamedResponse = ""
}
```

---

### 9. è°ƒè¯•æ”¯æŒ

#### æ¡ä»¶ç¼–è¯‘

**è°ƒè¯•è¾“å‡º:**
```swift
#if DEBUG
print("GIF è·¯å¾„: \(gifUrl.path)")
print("æ€»å¸§æ•°: \(frameCount)")
print("æ€»æ—¶é•¿: \(totalDuration)ç§’")
#endif
```

**ä¼˜ç‚¹:**
- å‘å¸ƒç‰ˆæœ¬ä¸åŒ…å«è°ƒè¯•ä»£ç 
- å‡å°åº”ç”¨ä½“ç§¯
- æé«˜æ€§èƒ½

---

#### é”™è¯¯æ—¥å¿—

**ç½‘ç»œé”™è¯¯:**
```swift
if let error = error {
    print("ç½‘ç»œé”™è¯¯: \(error.localizedDescription)")
}
```

**æ–‡ä»¶é”™è¯¯:**
```swift
catch {
    print("æ–‡ä»¶æ“ä½œå¤±è´¥: \(error.localizedDescription)")
}
```

**JSON é”™è¯¯:**
```swift
guard let json = try? JSONSerialization.jsonObject(with: data) else {
    print("JSON è§£æå¤±è´¥")
    continue
}
```

---

## æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡

- **æ¨¡å—åŒ–**: æŒ‰åŠŸèƒ½åˆ’åˆ†æ¨¡å—
- **å•ä¸€èŒè´£**: æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **æ¸…æ™°å‘½å**: ä½¿ç”¨æè¿°æ€§çš„å˜é‡å’Œæ–¹æ³•å
- **æ³¨é‡Šæ–‡æ¡£**: ä¸ºå¤æ‚é€»è¾‘æ·»åŠ æ³¨é‡Š

### 2. çŠ¶æ€ç®¡ç†

- **æœ€å°åŒ–çŠ¶æ€**: åªä¿ç•™å¿…è¦çš„çŠ¶æ€
- **å•å‘æ•°æ®æµ**: æ•°æ®ä»ä¸Šåˆ°ä¸‹æµåŠ¨
- **ä¸å¯å˜æ€§**: å°½é‡ä½¿ç”¨ä¸å¯å˜æ•°æ®
- **å“åº”å¼æ›´æ–°**: ä½¿ç”¨ @Published è‡ªåŠ¨æ›´æ–°

### 3. æ€§èƒ½ä¼˜åŒ–

- **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½èµ„æº
- **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜å¸¸ç”¨æ•°æ®
- **å¼‚æ­¥å¤„ç†**: è€—æ—¶æ“ä½œæ”¾åœ¨åå°
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº

### 4. ç”¨æˆ·ä½“éªŒ

- **å³æ—¶åé¦ˆ**: æ“ä½œåç«‹å³ç»™äºˆåé¦ˆ
- **åŠ è½½çŠ¶æ€**: æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
- **é”™è¯¯æç¤º**: å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- **å¹³æ»‘åŠ¨ç”»**: ä½¿ç”¨åŠ¨ç”»è¿‡æ¸¡çŠ¶æ€

### 5. å¯ç»´æŠ¤æ€§

- **ä»£ç å¤ç”¨**: æå–å…¬å…±ç»„ä»¶
- **è®¾è®¡ç³»ç»Ÿ**: ç»Ÿä¸€çš„æ ·å¼å’Œç»„ä»¶
- **ç±»å‹å®‰å…¨**: ä½¿ç”¨å¼ºç±»å‹
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

---

## æ‰©å±•å»ºè®®

### åŠŸèƒ½æ‰©å±•

1. **æ›´å¤šè§’è‰²**: æ·»åŠ æ›´å¤šå†…ç½®è§’è‰²
2. **ä¸»é¢˜ç³»ç»Ÿ**: æ”¯æŒè‡ªå®šä¹‰ä¸»é¢˜é¢œè‰²
3. **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶
4. **äº‘åŒæ­¥**: åŒæ­¥è®¾ç½®å’Œè§’è‰²åˆ°äº‘ç«¯
5. **è¯­éŸ³äº¤äº’**: æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¾“å‡º
6. **è¡¨æƒ…ç³»ç»Ÿ**: æ ¹æ®å¯¹è¯å†…å®¹æ˜¾ç¤ºä¸åŒè¡¨æƒ…
7. **ä»»åŠ¡æé†’**: å®šæ—¶æé†’åŠŸèƒ½
8. **å¤©æ°”æ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰å¤©æ°”ä¿¡æ¯

### æŠ€æœ¯æ”¹è¿›

1. **SwiftUI ä¼˜åŒ–**: ä½¿ç”¨æœ€æ–°çš„ SwiftUI ç‰¹æ€§
2. **æ€§èƒ½ç›‘æ§**: æ·»åŠ æ€§èƒ½ç›‘æ§å·¥å…·
3. **å´©æºƒæŠ¥å‘Š**: é›†æˆå´©æºƒæŠ¥å‘Šç³»ç»Ÿ
4. **å•å…ƒæµ‹è¯•**: æ·»åŠ å•å…ƒæµ‹è¯•
5. **UI æµ‹è¯•**: æ·»åŠ  UI è‡ªåŠ¨åŒ–æµ‹è¯•
6. **æŒç»­é›†æˆ**: é…ç½® CI/CD æµç¨‹
7. **ä»£ç è´¨é‡**: ä½¿ç”¨ SwiftLint ç­‰å·¥å…·

### ç”¨æˆ·ä½“éªŒ

1. **å¼•å¯¼æ•™ç¨‹**: é¦–æ¬¡ä½¿ç”¨å¼•å¯¼
2. **å¿«æ·æ“ä½œ**: æ·»åŠ æ›´å¤šå¿«æ·é”®
3. **æ‰‹åŠ¿æ”¯æŒ**: æ”¯æŒæ›´å¤šæ‰‹åŠ¿æ“ä½œ
4. **å¤šè¯­è¨€**: æ”¯æŒå¤šè¯­è¨€ç•Œé¢
5. **æ— éšœç¢**: å®Œå–„æ— éšœç¢æ”¯æŒ
6. **è‡ªå®šä¹‰å¸ƒå±€**: æ›´çµæ´»çš„å¸ƒå±€é€‰é¡¹
7. **åŠ¨ç”»ç¼–è¾‘å™¨**: å¯è§†åŒ–ç¼–è¾‘åŠ¨ç”»

---

## æ€»ç»“

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ¡Œé¢å® ç‰©åº”ç”¨ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„ SwiftUI æ¶æ„ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

**æŠ€æœ¯äº®ç‚¹:**
- MVVM æ¶æ„æ¨¡å¼
- å“åº”å¼çŠ¶æ€ç®¡ç†
- æµå¼ API é€šä¿¡
- è‡ªå®šä¹‰ GIF å¤„ç†
- å®Œå–„çš„æ•°æ®æŒä¹…åŒ–

**åŠŸèƒ½ç‰¹è‰²:**
- å¯çˆ±çš„æ¡Œé¢å® ç‰©
- AI å¯¹è¯äº¤äº’
- è‡ªåŠ¨äº’åŠ¨ç³»ç»Ÿ
- å¤šè§’è‰²æ”¯æŒ
- è‡ªå®šä¹‰è§’è‰²å¯¼å…¥
- éŸ³ä¹æ’­æ”¾é›†æˆ

**ç”¨æˆ·ä½“éªŒ:**
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- å®æ—¶çš„è§†è§‰åé¦ˆ
- å‹å¥½çš„é”™è¯¯æç¤º
- å®Œå–„çš„è®¾ç½®ç•Œé¢
- ç›´è§‚çš„æ“ä½œæ–¹å¼

**ä»£ç è´¨é‡:**
- æ¸…æ™°çš„ä»£ç ç»“æ„
- å®Œå–„çš„æ³¨é‡Šæ–‡æ¡£
- è‰¯å¥½çš„é”™è¯¯å¤„ç†
- åˆç†çš„å†…å­˜ç®¡ç†
- å¯æ‰©å±•çš„æ¶æ„è®¾è®¡

è¿™ä»½æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†é¡¹ç›®çš„æ¯ä¸ªæ–¹é¢ï¼Œä»æ¶æ„è®¾è®¡åˆ°å…·ä½“å®ç°ï¼Œä»æ•°æ®æµå‘åˆ°ç”¨æˆ·ç•Œé¢ï¼Œä¸ºç†è§£å’Œç»´æŠ¤é¡¹ç›®æä¾›äº†å…¨é¢çš„å‚è€ƒã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-01-09  
**ä½œè€…**: Kiro AI Assistant
